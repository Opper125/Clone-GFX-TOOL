<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaming Shop - Myanmar</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            font-family: 'Inter', 'Poppins', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .animate-fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }
        
        .animate-slide-up {
            animation: slideUp 0.8s ease-out;
        }
        
        .animate-pulse-custom {
            animation: pulseCustom 2s infinite;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulseCustom {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
            transition: all 0.3s ease;
        }
        
        .neon-glow:hover {
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
            transform: translateY(-2px);
        }
        
        .product-card {
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-gradient:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            transform: translateY(-2px);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            z-index: 1001;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .face-scan-circle {
            width: 200px;
            height: 200px;
            border: 3px solid #667eea;
            border-radius: 50%;
            position: relative;
            animation: scanPulse 2s infinite;
        }
        
        @keyframes scanPulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }
        
        .file-upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            border-color: #764ba2;
            background-color: rgba(102, 126, 234, 0.05);
        }
        
        .file-upload-area.dragover {
            border-color: #764ba2;
            background-color: rgba(102, 126, 234, 0.1);
        }
        
        .preview-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            position: relative;
        }
        
        .delete-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }
        
        .navbar-blur {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
        }
        
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .face-scan-circle {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center z-50">
        <div class="text-center text-white">
            <div class="loading-spinner mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold animate-pulse-custom">Gaming Shop Loading...</h2>
            <p class="mt-2 opacity-80">Please wait...</p>
        </div>
    </div>

    <!-- Auth Container -->
    <div id="authContainer" class="min-h-screen gradient-bg flex items-center justify-center p-4" style="display: none;">
        <div class="glass-morphism rounded-2xl p-8 w-full max-w-md animate-slide-up">
            <div class="text-center mb-8">
                <div id="websiteLogo" class="mb-4">
                    <i class="fas fa-gamepad text-6xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">Gaming Shop</h1>
                <p class="text-white opacity-80">Myanmar Gaming Marketplace</p>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="space-y-6">
                <h2 class="text-2xl font-bold text-white text-center mb-6">အကောင့်ဝင်ရန်</h2>
                <div>
                    <input type="email" id="loginEmail" placeholder="Gmail လိပ်စာ" class="w-full px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-white focus:outline-none">
                </div>
                <div>
                    <input type="password" id="loginPassword" placeholder="Password" class="w-full px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-white focus:outline-none">
                </div>
                <button onclick="login()" class="w-full btn-gradient text-white py-3 px-6 rounded-lg font-semibold neon-glow">
                    <i class="fas fa-sign-in-alt mr-2"></i>အကောင့်ဝင်ရန်
                </button>
                <p class="text-center text-white">
                    အကောင့်မရှိပါသေးလား? 
                    <button onclick="showSignup()" class="underline hover:text-yellow-300">စာရင်းသွင်းရန်</button>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" class="space-y-6" style="display: none;">
                <h2 class="text-2xl font-bold text-white text-center mb-6">အကောင့်ဖွင့်ရန်</h2>
                <div>
                    <input type="text" id="signupName" placeholder="အမည်" class="w-full px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-white focus:outline-none">
                </div>
                <div>
                    <input type="email" id="signupEmail" placeholder="Gmail လိပ်စာ" class="w-full px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-white focus:outline-none">
                </div>
                <div>
                    <input type="text" id="signupUsername" placeholder="Username" class="w-full px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-white focus:outline-none">
                </div>
                <div>
                    <input type="password" id="signupPassword" placeholder="Password" class="w-full px-4 py-3 rounded-lg border-0 focus:ring-2 focus:ring-white focus:outline-none">
                </div>
                <button onclick="signup()" class="w-full btn-gradient text-white py-3 px-6 rounded-lg font-semibold neon-glow">
                    <i class="fas fa-user-plus mr-2"></i>အကောင့်ဖွင့်ရန်
                </button>
                <p class="text-center text-white">
                    အကောင့်ရှိပီးသားလား? 
                    <button onclick="showLogin()" class="underline hover:text-yellow-300">အကောင့်ဝင်ရန်</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="min-h-screen bg-gray-50" style="display: none;">
        <!-- Header -->
        <header class="navbar-blur sticky top-0 z-40 border-b border-gray-200">
            <div class="container mx-auto px-4 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div id="dashboardLogo" class="text-3xl">
                            <i class="fas fa-gamepad text-purple-600"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">Gaming Shop</h1>
                            <p class="text-sm text-gray-600">Myanmar Gaming Marketplace</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <img id="userAvatar" src="https://via.placeholder.com/40" alt="User" class="w-10 h-10 rounded-full cursor-pointer border-2 border-purple-300" onclick="toggleUserMenu()">
                            <div id="userMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border hidden">
                                <div class="p-3 border-b">
                                    <p class="font-semibold text-gray-800" id="userDisplayName">User Name</p>
                                    <p class="text-sm text-gray-600" id="userDisplayEmail">user@email.com</p>
                                </div>
                                <button onclick="logout()" class="w-full text-left px-4 py-2 hover:bg-gray-100 text-red-600">
                                    <i class="fas fa-sign-out-alt mr-2"></i>ထွက်ရန်
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white border-b border-gray-200 sticky top-16 z-30">
            <div class="container mx-auto px-4">
                <div class="flex space-x-1 overflow-x-auto">
                    <button onclick="showTab('home')" class="tab-btn px-6 py-3 font-medium text-purple-600 border-b-2 border-purple-600 whitespace-nowrap">
                        <i class="fas fa-home mr-2"></i>HOME
                    </button>
                    <button onclick="showTab('history')" class="tab-btn px-6 py-3 font-medium text-gray-600 hover:text-purple-600 whitespace-nowrap">
                        <i class="fas fa-history mr-2"></i>History
                    </button>
                    <button onclick="showTab('news')" class="tab-btn px-6 py-3 font-medium text-gray-600 hover:text-purple-600 whitespace-nowrap">
                        <i class="fas fa-newspaper mr-2"></i>News
                    </button>
                    <button onclick="showTab('profile')" class="tab-btn px-6 py-3 font-medium text-gray-600 hover:text-purple-600 whitespace-nowrap">
                        <i class="fas fa-user mr-2"></i>Profile
                    </button>
                    <button id="sellerTab" onclick="showTab('seller')" class="tab-btn px-6 py-3 font-medium text-gray-600 hover:text-purple-600 whitespace-nowrap" style="display: none;">
                        <i class="fas fa-store mr-2"></i>Seller
                    </button>
                </div>
            </div>
        </nav>

        <!-- Content Area -->
        <main class="container mx-auto px-4 py-6">
            <!-- Home Tab -->
            <div id="homeTab" class="tab-content active">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="productsGrid">
                    <!-- Products will be loaded here -->
                </div>
            </div>

            <!-- History Tab -->
            <div id="historyTab" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-2xl font-bold mb-6">မှာယူမှု့ မှတ်တမ်း</h2>
                    <div id="orderHistory" class="space-y-4">
                        <!-- Order history will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- News Tab -->
            <div id="newsTab" class="tab-content">
                <div class="space-y-6" id="newsContainer">
                    <!-- News will be loaded here -->
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profileTab" class="tab-content">
                <div class="max-w-2xl mx-auto space-y-6">
                    <!-- Profile Info -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h2 class="text-2xl font-bold mb-6">ကိုယ်ရေးကိုယ်တာ အချက်အလက်</h2>
                        <div class="flex items-center space-x-6 mb-6">
                            <div class="relative">
                                <img id="profileImage" src="https://via.placeholder.com/100" alt="Profile" class="w-24 h-24 rounded-full border-4 border-purple-300">
                                <button onclick="changeProfileImage()" class="absolute bottom-0 right-0 bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center">
                                    <i class="fas fa-camera text-sm"></i>
                                </button>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold" id="profileName">User Name</h3>
                                <p class="text-gray-600" id="profileEmail">user@email.com</p>
                                <p class="text-sm text-gray-500">@<span id="profileUsername">username</span></p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">အမည်</label>
                                <input type="text" id="editName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                <input type="text" id="editUsername" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Gmail</label>
                                <input type="email" id="editEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password အသစ်</label>
                                <input type="password" id="editPassword" placeholder="အသစ်ပြောင်းရန်" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none">
                            </div>
                        </div>
                        
                        <button onclick="updateProfile()" class="mt-6 btn-gradient text-white px-6 py-2 rounded-lg font-semibold">
                            <i class="fas fa-save mr-2"></i>သိမ်းဆည်းရန်
                        </button>
                    </div>

                    <!-- KYC Section -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h2 class="text-2xl font-bold mb-6">KYC အတည်ပြုခြင်း</h2>
                        <div id="kycStatus">
                            <!-- KYC status will be loaded here -->
                        </div>
                    </div>

                    <!-- About Section -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h2 class="text-2xl font-bold mb-6">About</h2>
                        <div id="aboutSection">
                            <!-- About links will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seller Tab -->
            <div id="sellerTab" class="tab-content">
                <div class="space-y-6">
                    <!-- Seller Dashboard Navigation -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex flex-wrap gap-4">
                            <button onclick="showSellerSection('products')" class="seller-nav-btn bg-purple-600 text-white px-4 py-2 rounded-lg font-medium">
                                <i class="fas fa-box mr-2"></i>ကိုယ်ပိုင် Products
                            </button>
                            <button onclick="showSellerSection('add-product')" class="seller-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium">
                                <i class="fas fa-plus mr-2"></i>Product တင်ရန်
                            </button>
                            <button onclick="showSellerSection('payments')" class="seller-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium">
                                <i class="fas fa-credit-card mr-2"></i>Payment စနစ်
                            </button>
                            <button onclick="showSellerSection('orders')" class="seller-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium">
                                <i class="fas fa-shopping-cart mr-2"></i>Orders
                            </button>
                        </div>
                    </div>

                    <!-- Seller Content Sections -->
                    <div id="sellerProducts" class="seller-section">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-xl font-bold mb-4">ကိုယ်ပိုင် Products</h3>
                            <div id="myProductsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- My products will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <div id="sellerAddProduct" class="seller-section" style="display: none;">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-xl font-bold mb-4">Product တင်ရန်</h3>
                            <form id="addProductForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Product အမည်</label>
                                    <input type="text" id="productName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">အကြောင်းအရာ</label>
                                    <textarea id="productDescription" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">စျေးနှုန်း (MMK)</label>
                                    <input type="number" id="productPrice" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Game အမျိုးအစား</label>
                                    <input type="text" id="productGame" placeholder="eg. PUBG Mobile" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Login Social Platform</label>
                                    <select id="productSocial" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                                        <option value="">ရွေးချယ်ပါ</option>
                                        <option value="Google">Google</option>
                                        <option value="Facebook">Facebook</option>
                                        <option value="X">X (Twitter)</option>
                                        <option value="iCloud">iCloud</option>
                                        <option value="QR Login">QR Login</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ဆက်သွယ်ရန် Social Name</label>
                                    <input type="text" id="contactSocialName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ဆက်သွယ်ရန် လိပ်စာ/လင်း</label>
                                    <input type="text" id="contactSocialLink" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Account အချက်အလက် ဖိုင်များ</label>
                                    <div class="file-upload-area" onclick="document.getElementById('productFiles').click()">
                                        <i class="fas fa-cloud-upload-alt text-4xl text-purple-500 mb-2"></i>
                                        <p class="text-gray-600">ပုံ/ဗီဒီယို ဖိုင်များ ရွေးချယ်ရန် နှိပ်ပါ</p>
                                        <input type="file" id="productFiles" multiple accept="image/*,video/*" style="display: none;" onchange="handleProductFiles(this.files)">
                                    </div>
                                    <div id="productFilePreview" class="mt-4 grid grid-cols-4 gap-2"></div>
                                </div>
                                <button type="submit" class="w-full btn-gradient text-white py-3 px-6 rounded-lg font-semibold">
                                    <i class="fas fa-plus mr-2"></i>Product တင်ရန်
                                </button>
                            </form>
                        </div>
                    </div>

                    <div id="sellerPayments" class="seller-section" style="display: none;">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-xl font-bold mb-4">Payment စနစ်များ</h3>
                            <div id="myPaymentsList" class="space-y-4 mb-6">
                                <!-- My payments will be loaded here -->
                            </div>
                            <button onclick="showAddPaymentModal()" class="btn-gradient text-white px-4 py-2 rounded-lg font-medium">
                                <i class="fas fa-plus mr-2"></i>Payment အသစ်ထည့်ရန်
                            </button>
                        </div>
                    </div>

                    <div id="sellerOrders" class="seller-section" style="display: none;">
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-xl font-bold mb-4">Orders</h3>
                            <div id="myOrdersList" class="space-y-4">
                                <!-- My orders will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Product Detail Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Product အသေးစိတ်</h2>
                <button onclick="closeModal('productModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="productDetailContent">
                <!-- Product details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Buy Modal -->
    <div id="buyModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">ငွေပေးချေရန်</h2>
                <button onclick="closeModal('buyModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="buyContent">
                <!-- Buy content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- KYC Modal -->
    <div id="kycModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">KYC အတည်ပြုခြင်း</h2>
                <button onclick="closeModal('kycModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="kycForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">အမည်</label>
                    <input type="text" id="kycName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">မွေးနေ့</label>
                    <input type="date" id="kycBirthdate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ဖုန်းနံပါတ်</label>
                    <input type="tel" id="kycPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">လိပ်စာ</label>
                    <textarea id="kycAddress" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">အထောက်အထား</label>
                    <select id="kycIdType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                        <option value="">ရွေးချယ်ပါ</option>
                        <option value="NRC">NRC</option>
                        <option value="Passport">Passport</option>
                        <option value="DriverLicense">ယဉ်းမောင်းလိုင်စင်</option>
                    </select>
                </div>
                <div id="nrcSection" style="display: none;">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">NRC အရှေ့</label>
                            <input type="file" id="nrcFront" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">NRC အနောက်</label>
                            <input type="file" id="nrcBack" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none">
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button type="button" onclick="startFaceScan()" class="btn-gradient text-white px-6 py-2 rounded-lg font-semibold">
                        <i class="fas fa-camera mr-2"></i>မျက်နှာ စကင်န် ဖတ်ရန်
                    </button>
                </div>
                <div id="faceScanSection" style="display: none;" class="text-center">
                    <div class="face-scan-circle mx-auto mb-4 flex items-center justify-center">
                        <video id="faceScanVideo" width="180" height="180" autoplay style="border-radius: 50%;"></video>
                    </div>
                    <div id="faceScanInstructions" class="space-y-2">
                        <p id="scanInstruction" class="font-semibold text-purple-600">မျက်နှာကို စက်ဝိုင်းထဲမှာ ထည့်ပါ</p>
                        <div id="scanSteps" class="text-sm text-gray-600">
                            <p>✓ မျက်နှာအပြည့်ပြပါ</p>
                            <p id="blinkStep">• မျက်တောင်ခတ်ပါ</p>
                            <p id="leftStep">• ဘယ်ဘက်လှည့်ပါ</p>
                            <p id="rightStep">• ညာဘက်လှည့်ပါ</p>
                            <p id="mouthStep">• ပါးစပ်ဖွင့်ပါ</p>
                        </div>
                    </div>
                </div>
                <button type="submit" id="submitKyc" class="w-full btn-gradient text-white py-3 px-6 rounded-lg font-semibold" disabled>
                    <i class="fas fa-check mr-2"></i>KYC တင်ရန်
                </button>
            </form>
        </div>
    </div>

    <!-- Add Payment Modal -->
    <div id="addPaymentModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Payment အသစ်ထည့်ရန်</h2>
                <button onclick="closeModal('addPaymentModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="addPaymentForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Payment အမည်</label>
                    <input type="text" id="paymentName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">အကြောင်းအရာ</label>
                    <textarea id="paymentDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ဖုန်းနံပါတ်/လိပ်စာ</label>
                    <input type="text" id="paymentAddress" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Payment Icon</label>
                    <input type="file" id="paymentIcon" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">QR Code</label>
                    <input type="file" id="paymentQr" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:outline-none" required>
                </div>
                <button type="submit" class="w-full btn-gradient text-white py-3 px-6 rounded-lg font-semibold">
                    <i class="fas fa-plus mr-2"></i>Payment ထည့်ရန်
                </button>
            </form>
        </div>
    </div>

    <!-- Profile Image Modal -->
    <div id="profileImageModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Profile ရုပ်ပုံ ပြောင်းရန်</h2>
                <button onclick="closeModal('profileImageModal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="text-center">
                <input type="file" id="profileImageFile" accept="image/*,.gif" class="mb-4">
                <div id="profileImagePreview" class="mb-4"></div>
                <button onclick="uploadProfileImage()" class="btn-gradient text-white px-6 py-2 rounded-lg font-semibold">
                    <i class="fas fa-upload mr-2"></i>ရုပ်ပုံ ပြောင်းရန်
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Cloudinary Configuration
        const CLOUDINARY_CLOUD_NAME = 'opper';
        const CLOUDINARY_UPLOAD_PRESET = 'gaming_shop_preset'; // You need to create this in Cloudinary dashboard
        const CLOUDINARY_URL = 'cloudinary://589981285168918:jMHqgkHVBL5PvVSpzIc9-FJWg8w@opper';
        
        // Supabase Configuration
        const SUPABASE_URL = 'https://rmeudvhvqlddqqkiziyo.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtZXVkdmh2cWxkZHFxa2l6aXlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5OTMxOTIsImV4cCI6MjA2OTU2OTE5Mn0.xFgMv-K5o5yyTpe4U2YJK5jC9GPJp98G4cgD9p5W4ak';
        
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        let currentUser = null;
        let currentProductFiles = [];
        let faceScanData = null;
        let stream = null;

        // Initialize
        window.onload = async function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('authContainer').style.display = 'flex';
            }, 2000);
            
            await loadWebsiteLogo();
            await loadAboutData();
        };

        // Authentication Functions
        function showSignup() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'block';
        }

        function showLogin() {
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }

        async function signup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const username = document.getElementById('signupUsername').value;
            const password = document.getElementById('signupPassword').value;

            if (!name || !email || !username || !password) {
                showNotification('အချက်အလက်များ အပြည့်အစုံ ဖြည့်သွင်းပါ', 'error');
                return;
            }

            try {
                // Check if email or username already exists
                const { data: existingUsers } = await supabase
                    .from('users')
                    .select('*')
                    .or(`email.eq.${email},username.eq.${username}`);

                if (existingUsers && existingUsers.length > 0) {
                    showNotification('Gmail လိပ်စာ သို့မဟုတ် Username ရှိပြီးသားဖြစ်ပါတယ်', 'error');
                    return;
                }

                // Insert new user
                const { data, error } = await supabase
                    .from('users')
                    .insert([{
                        name: name,
                        email: email,
                        username: username,
                        password: password,
                        profile_image: 'https://via.placeholder.com/100',
                        created_at: new Date().toISOString()
                    }])
                    .select();

                if (error) throw error;

                showNotification('အကောင့်ဖွင့်ခြင်း အောင်မြင်ပါတယ်', 'success');
                showLogin();
            } catch (error) {
                showNotification('အကောင့်ဖွင့်ခြင်း မအောင်မြင်ပါ', 'error');
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showNotification('Gmail နဲ့ Password ဖြည့်သွင်းပါ', 'error');
                return;
            }

            try {
                const { data: users, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('email', email)
                    .eq('password', password);

                if (error) throw error;

                if (users && users.length > 0) {
                    currentUser = users[0];
                    await loadDashboard();
                    showNotification('အကောင့်ဝင်ခြင်း အောင်မြင်ပါတယ်', 'success');
                } else {
                    showNotification('Gmail သို့မဟုတ် Password မမှန်ကန်ပါ', 'error');
                }
            } catch (error) {
                showNotification('အကောင့်ဝင်ခြင်း မအောင်မြင်ပါ', 'error');
            }
        }

        async function loadDashboard() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Update user info
            document.getElementById('userDisplayName').textContent = currentUser.name;
            document.getElementById('userDisplayEmail').textContent = currentUser.email;
            document.getElementById('userAvatar').src = currentUser.profile_image || 'https://via.placeholder.com/40';
            
            // Load profile data
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('profileUsername').textContent = currentUser.username;
            document.getElementById('profileImage').src = currentUser.profile_image || 'https://via.placeholder.com/100';
            
            document.getElementById('editName').value = currentUser.name;
            document.getElementById('editEmail').value = currentUser.email;
            document.getElementById('editUsername').value = currentUser.username;
            
            await loadProducts();
            await loadNews();
            await loadOrderHistory();
            await loadKYCStatus();
            await checkSellerStatus();
        }

        function logout() {
            currentUser = null;
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('authContainer').style.display = 'flex';
            showLogin();
            showNotification('အကောင့်မှ ထွက်ခြင်း အောင်မြင်ပါတယ်', 'success');
        }

        // Tab Functions
        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Update tab buttons
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.classList.remove('text-purple-600', 'border-b-2', 'border-purple-600');
                btn.classList.add('text-gray-600');
            });
            
            event.target.classList.remove('text-gray-600');
            event.target.classList.add('text-purple-600', 'border-b-2', 'border-purple-600');
        }

        // Product Functions
        async function loadProducts() {
            try {
                const { data: products, error } = await supabase
                    .from('products')
                    .select(`
                        *,
                        users!products_seller_id_fkey (name, username, profile_image)
                    `)
                    .eq('status', 'active');

                if (error) throw error;

                const grid = document.getElementById('productsGrid');
                grid.innerHTML = '';

                products.forEach(product => {
                    const productCard = createProductCard(product);
                    grid.appendChild(productCard);
                });
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        function createProductCard(product) {
            const div = document.createElement('div');
            div.className = 'product-card bg-white rounded-lg shadow-sm overflow-hidden cursor-pointer';
            div.onclick = () => showProductDetail(product.id);
            
            const images = product.images ? JSON.parse(product.images) : [];
            const mainImage = images.length > 0 ? images[0] : 'https://via.placeholder.com/300x200';
            
            div.innerHTML = `
                <div class="relative">
                    <img src="${mainImage}" alt="${product.name}" class="w-full h-48 object-cover">
                    ${product.sold_out ? '<div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"><span class="text-white font-bold text-xl">SOLD OUT</span></div>' : ''}
                </div>
                <div class="p-4">
                    <h3 class="font-semibold text-lg mb-2 truncate">${product.name}</h3>
                    <p class="text-purple-600 font-bold text-xl">${product.price.toLocaleString()} MMK</p>
                    <p class="text-gray-600 text-sm mt-1">${product.game}</p>
                    ${product.sold_out && product.buyer_username ? `
                        <div class="mt-3 pt-3 border-t flex items-center space-x-2">
                            <img src="${product.users?.profile_image || 'https://via.placeholder.com/30'}" alt="Buyer" class="w-6 h-6 rounded-full">
                            <span class="text-sm text-gray-600">Sold to @${product.buyer_username}</span>
                        </div>
                    ` : ''}
                </div>
            `;
            
            return div;
        }

        async function showProductDetail(productId) {
            try {
                const { data: product, error } = await supabase
                    .from('products')
                    .select(`
                        *,
                        users!products_seller_id_fkey (name, username, profile_image)
                    `)
                    .eq('id', productId)
                    .single();

                if (error) throw error;

                const modal = document.getElementById('productModal');
                const content = document.getElementById('productDetailContent');
                
                const images = product.images ? JSON.parse(product.images) : [];
                const videos = product.videos ? JSON.parse(product.videos) : [];
                
                content.innerHTML = `
                    <div class="space-y-6">
                        ${images.length > 0 ? `
                            <div class="grid grid-cols-2 gap-2">
                                ${images.map(img => `<img src="${img}" class="w-full h-32 object-cover rounded-lg">`).join('')}
                            </div>
                        ` : ''}
                        
                        ${videos.length > 0 ? `
                            <div class="space-y-2">
                                ${videos.map(video => `<video controls class="w-full rounded-lg"><source src="${video}" type="video/mp4"></video>`).join('')}
                            </div>
                        ` : ''}
                        
                        <div>
                            <h3 class="text-2xl font-bold mb-2">${product.name}</h3>
                            <p class="text-3xl font-bold text-purple-600 mb-4">${product.price.toLocaleString()} MMK</p>
                            <p class="text-gray-600 mb-4">${product.description}</p>
                            
                            <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                                <p><strong>Game:</strong> ${product.game}</p>
                                <p><strong>Social Platform:</strong> ${product.social_platform}</p>
                                <p><strong>Contact:</strong> ${product.contact_social_name} - ${product.contact_social_link}</p>
                            </div>
                            
                            <div class="flex items-center space-x-3 mt-4 p-3 bg-blue-50 rounded-lg">
                                <img src="${product.users?.profile_image || 'https://via.placeholder.com/40'}" alt="Seller" class="w-10 h-10 rounded-full">
                                <div>
                                    <p class="font-semibold">${product.users?.name}</p>
                                    <p class="text-sm text-gray-600">@${product.users?.username}</p>
                                </div>
                            </div>
                        </div>
                        
                        ${!product.sold_out ? `
                            <button onclick="showBuyModal(${product.id})" class="w-full btn-gradient text-white py-3 px-6 rounded-lg font-semibold">
                                <i class="fas fa-shopping-cart mr-2"></i>ဝယ်ယူရန်
                            </button>
                        ` : `
                            <div class="text-center py-4">
                                <p class="text-red-600 font-bold text-xl">SOLD OUT</p>
                            </div>
                        `}
                    </div>
                `;
                
                modal.style.display = 'block';
            } catch (error) {
                console.error('Error loading product detail:', error);
            }
        }

        async function showBuyModal(productId) {
            closeModal('productModal');
            
            try {
                // Get product details
                const { data: product } = await supabase
                    .from('products')
                    .select('*')
                    .eq('id', productId)
                    .single();

                // Get payment methods for this seller
                const { data: payments } = await supabase
                    .from('user_payments')
                    .select('*')
                    .eq('user_id', product.seller_id);

                const modal = document.getElementById('buyModal');
                const content = document.getElementById('buyContent');
                
                content.innerHTML = `
                    <div class="space-y-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-bold mb-2">${product.name}</h3>
                            <p class="text-2xl font-bold text-purple-600">${product.price.toLocaleString()} MMK</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold mb-3">Payment Method ရွေးချယ်ပါ</h4>
                            <div class="space-y-2" id="paymentMethodsList">
                                ${payments.map(payment => `
                                    <label class="flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                        <input type="radio" name="paymentMethod" value="${payment.id}" class="text-purple-600">
                                        <img src="${payment.icon_url}" alt="${payment.name}" class="w-8 h-8 rounded">
                                        <span class="font-medium">${payment.name}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div id="paymentDetails" style="display: none;" class="bg-blue-50 p-4 rounded-lg">
                            <!-- Payment details will be loaded here -->
                        </div>
                        
                        <div id="proofUpload" style="display: none;">
                            <h4 class="font-semibold mb-3">ငွေလွှဲ ပြေစာ တင်ရန်</h4>
                            <div class="file-upload-area" onclick="document.getElementById('proofFiles').click()">
                                <i class="fas fa-cloud-upload-alt text-4xl text-purple-500 mb-2"></i>
                                <p class="text-gray-600">ငွေလွှဲ ပြေစာ ပုံများ ရွေးချယ်ရန် နှိပ်ပါ</p>
                                <input type="file" id="proofFiles" multiple accept="image/*" style="display: none;" onchange="handleProofFiles(this.files)">
                            </div>
                            <div id="proofPreview" class="mt-4 grid grid-cols-4 gap-2"></div>
                        </div>
                        
                        <button id="confirmOrderBtn" onclick="confirmOrder(${productId})" class="w-full btn-gradient text-white py-3 px-6 rounded-lg font-semibold" style="display: none;">
                            <i class="fas fa-check mr-2"></i>မှာယူမှု အတည်ပြုရန်
                        </button>
                    </div>
                `;
                
                // Add payment method selection handler
                content.addEventListener('change', function(e) {
                    if (e.target.name === 'paymentMethod') {
                        showPaymentDetails(e.target.value);
                    }
                });
                
                modal.style.display = 'block';
            } catch (error) {
                console.error('Error loading buy modal:', error);
            }
        }

        async function showPaymentDetails(paymentId) {
            try {
                const { data: payment } = await supabase
                    .from('user_payments')
                    .select('*')
                    .eq('id', paymentId)
                    .single();

                const detailsDiv = document.getElementById('paymentDetails');
                detailsDiv.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex items-center space-x-3">
                            <img src="${payment.icon_url}" alt="${payment.name}" class="w-12 h-12 rounded">
                            <div>
                                <h5 class="font-bold">${payment.name}</h5>
                                <p class="text-sm text-gray-600">${payment.description || ''}</p>
                            </div>
                        </div>
                        <div class="bg-white p-3 rounded border">
                            <p class="font-semibold">ငွေလက်ခံမည့် လိပ်စာ:</p>
                            <p class="text-lg">${payment.address}</p>
                        </div>
                        ${payment.qr_code_url ? `
                            <div class="text-center">
                                <p class="font-semibold mb-2">QR Code:</p>
                                <img src="${payment.qr_code_url}" alt="QR Code" class="mx-auto max-w-xs rounded-lg">
                            </div>
                        ` : ''}
                    </div>
                `;
                detailsDiv.style.display = 'block';
                document.getElementById('proofUpload').style.display = 'block';
            } catch (error) {
                console.error('Error loading payment details:', error);
            }
        }

        let currentProofFiles = [];

        function handleProofFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    currentProofFiles.push(file);
                }
            });
            displayProofPreview();
        }

        function displayProofPreview() {
            const preview = document.getElementById('proofPreview');
            preview.innerHTML = '';
            
            currentProofFiles.forEach((file, index) => {
                const div = document.createElement('div');
                div.className = 'relative';
                
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.className = 'preview-image';
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '×';
                deleteBtn.onclick = () => removeProofFile(index);
                
                div.appendChild(img);
                div.appendChild(deleteBtn);
                preview.appendChild(div);
            });
            
            document.getElementById('confirmOrderBtn').style.display = currentProofFiles.length > 0 ? 'block' : 'none';
        }

        function removeProofFile(index) {
            currentProofFiles.splice(index, 1);
            displayProofPreview();
        }

        async function confirmOrder(productId) {
            if (currentProofFiles.length === 0) {
                showNotification('ငွေလွှဲ ပြေစာ တင်ပါ', 'error');
                return;
            }
            
            const selectedPayment = document.querySelector('input[name="paymentMethod"]:checked');
            if (!selectedPayment) {
                showNotification('Payment Method ရွေးချယ်ပါ', 'error');
                return;
            }
            
            try {
                // Upload proof images
                const proofUrls = await uploadMultipleFiles(currentProofFiles);
                
                // Create order
                const { data: order, error } = await supabase
                    .from('orders')
                    .insert([{
                        product_id: productId,
                        buyer_id: currentUser.id,
                        payment_method_id: selectedPayment.value,
                        proof_images: JSON.stringify(proofUrls),
                        status: 'pending',
                        created_at: new Date().toISOString()
                    }])
                    .select()
                    .single();

                if (error) throw error;
                
                closeModal('buyModal');
                showNotification('မှာယူမှု အောင်မြင်ပါတယ်', 'success');
                await loadOrderHistory();
                currentProofFiles = [];
            } catch (error) {
                console.error('Error confirming order:', error);
                showNotification('မှာယူမှု မအောင်မြင်ပါ', 'error');
            }
        }

        // Order History Functions
        async function loadOrderHistory() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        products (name, price, images),
                        users!orders_buyer_id_fkey (name, username)
                    `)
                    .eq('buyer_id', currentUser.id)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const container = document.getElementById('orderHistory');
                container.innerHTML = '';

                if (orders.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-8">မှာယူမှု မရှိပါသေးပါ</p>';
                    return;
                }

                orders.forEach(order => {
                    const orderDiv = createOrderCard(order);
                    container.appendChild(orderDiv);
                });
            } catch (error) {
                console.error('Error loading order history:', error);
            }
        }

        function createOrderCard(order) {
            const div = document.createElement('div');
            div.className = 'bg-white border rounded-lg p-4';
            
            const images = order.products.images ? JSON.parse(order.products.images) : [];
            const mainImage = images.length > 0 ? images[0] : 'https://via.placeholder.com/80';
            
            const statusColor = {
                'pending': 'bg-yellow-100 text-yellow-800',
                'confirmed': 'bg-green-100 text-green-800',
                'rejected': 'bg-red-100 text-red-800'
            };
            
            const statusText = {
                'pending': 'စောင့်ဆိုင်းနေသည်',
                'confirmed': 'အတည်ပြုပြီး',
                'rejected': 'ငြင်းဆိုပြီး'
            };
            
            div.innerHTML = `
                <div class="flex items-center space-x-4">
                    <img src="${mainImage}" alt="${order.products.name}" class="w-16 h-16 object-cover rounded-lg">
                    <div class="flex-1">
                        <h4 class="font-semibold">${order.products.name}</h4>
                        <p class="text-purple-600 font-bold">${order.products.price.toLocaleString()} MMK</p>
                        <p class="text-sm text-gray-500">${new Date(order.created_at).toLocaleDateString('my-MM')}</p>
                    </div>
                    <div class="text-right">
                        <span class="px-3 py-1 rounded-full text-sm font-medium ${statusColor[order.status]}">
                            ${statusText[order.status]}
                        </span>
                        ${order.status === 'confirmed' && order.receipt_url ? `
                            <button onclick="showReceipt('${order.receipt_url}')" class="block mt-2 text-sm text-purple-600 hover:underline">
                                စလစ် ကြည့်ရန်
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            return div;
        }

        function showReceipt(receiptUrl) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold">Order စလစ်</h2>
                        <button onclick="this.closest('.modal').remove()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="text-center">
                        <img src="${receiptUrl}" alt="Receipt" class="max-w-full max-h-96 mx-auto rounded-lg">
                        <div class="mt-4">
                            <a href="${receiptUrl}" download class="btn-gradient text-white px-4 py-2 rounded-lg font-medium">
                                <i class="fas fa-download mr-2"></i>Download
                            </a>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // News Functions
        async function loadNews() {
            try {
                const { data: news, error } = await supabase
                    .from('news')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const container = document.getElementById('newsContainer');
                container.innerHTML = '';

                if (news.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-8">သတင်း မရှိပါသေးပါ</p>';
                    return;
                }

                news.forEach(item => {
                    const newsDiv = createNewsCard(item);
                    container.appendChild(newsDiv);
                });
            } catch (error) {
                console.error('Error loading news:', error);
            }
        }

        function createNewsCard(news) {
            const div = document.createElement('div');
            div.className = 'bg-white rounded-lg shadow-sm p-6 animate-fade-in';
            
            const images = news.images ? JSON.parse(news.images) : [];
            const videos = news.videos ? JSON.parse(news.videos) : [];
            const socialLinks = news.social_links ? JSON.parse(news.social_links) : [];
            
            div.innerHTML = `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold">${news.title}</h2>
                    <p class="text-gray-600">${news.content}</p>
                    
                    ${images.length > 0 ? `
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                            ${images.map(img => `<img src="${img}" class="w-full h-32 object-cover rounded-lg">`).join('')}
                        </div>
                    ` : ''}
                    
                    ${videos.length > 0 ? `
                        <div class="space-y-2">
                            ${videos.map(video => `<video controls class="w-full rounded-lg"><source src="${video}" type="video/mp4"></video>`).join('')}
                        </div>
                    ` : ''}
                    
                    ${socialLinks.length > 0 ? `
                        <div class="flex flex-wrap gap-2">
                            ${socialLinks.map(link => `
                                <a href="${link.url}" target="_blank" class="inline-flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm">
                                    <i class="fab fa-${link.platform.toLowerCase()}"></i>
                                    <span>${link.platform}</span>
                                </a>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <p class="text-sm text-gray-500">${new Date(news.created_at).toLocaleDateString('my-MM')}</p>
                </div>
            `;
            
            return div;
        }

        // KYC Functions
        async function loadKYCStatus() {
            try {
                const { data: kyc, error } = await supabase
                    .from('kyc_submissions')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .single();

                const statusDiv = document.getElementById('kycStatus');
                
                if (!kyc) {
                    statusDiv.innerHTML = `
                        <div class="text-center py-6">
                            <i class="fas fa-id-card text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold mb-2">KYC မတင်ပြသေးပါ</h3>
                            <p class="text-gray-600 mb-4">Seller ဖြစ်ရန် KYC အတည်ပြုခြင်း လိုအပ်ပါတယ်</p>
                            <button onclick="showKYCModal()" class="btn-gradient text-white px-6 py-2 rounded-lg font-semibold">
                                <i class="fas fa-plus mr-2"></i>KYC တင်ရန်
                            </button>
                        </div>
                    `;
                } else {
                    const statusColor = {
                        'pending': 'bg-yellow-100 text-yellow-800',
                        'approved': 'bg-green-100 text-green-800',
                        'rejected': 'bg-red-100 text-red-800'
                    };
                    
                    const statusText = {
                        'pending': 'စောင့်ဆိုင်းနေသည်',
                        'approved': 'အတည်ပြုပြီး',
                        'rejected': 'ငြင်းဆိုပြီး'
                    };
                    
                    statusDiv.innerHTML = `
                        <div class="text-center py-6">
                            <div class="mb-4">
                                <span class="px-4 py-2 rounded-full text-lg font-medium ${statusColor[kyc.status]}">
                                    ${statusText[kyc.status]}
                                </span>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg text-left">
                                <h4 class="font-semibold mb-2">တင်ပြပြီးသား အချက်အလက်များ:</h4>
                                <p><strong>အမည်:</strong> ${kyc.full_name}</p>
                                <p><strong>ဖုန်းနံပါတ်:</strong> ${kyc.phone}</p>
                                <p><strong>လိပ်စာ:</strong> ${kyc.address}</p>
                                <p><strong>အထောက်အထား:</strong> ${kyc.id_type}</p>
                            </div>
                            ${kyc.status === 'rejected' ? `
                                <button onclick="showKYCModal()" class="mt-4 btn-gradient text-white px-6 py-2 rounded-lg font-semibold">
                                    <i class="fas fa-redo mr-2"></i>ပြန်တင်ရန်
                                </button>
                            ` : ''}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading KYC status:', error);
            }
        }

        function showKYCModal() {
            document.getElementById('kycModal').style.display = 'block';
            
            // Setup ID type change handler
            document.getElementById('kycIdType').addEventListener('change', function(e) {
                const nrcSection = document.getElementById('nrcSection');
                if (e.target.value === 'NRC') {
                    nrcSection.style.display = 'block';
                } else {
                    nrcSection.style.display = 'none';
                }
            });
        }

        function startFaceScan() {
            const scanSection = document.getElementById('faceScanSection');
            const video = document.getElementById('faceScanVideo');
            
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(mediaStream) {
                    stream = mediaStream;
                    video.srcObject = mediaStream;
                    scanSection.style.display = 'block';
                    
                    // Start face scanning process
                    startScanningProcess();
                })
                .catch(function(err) {
                    showNotification('ကင်မရာ ဖွင့်၍ မရပါ', 'error');
                });
        }

        let scanStep = 0;
        const scanSteps = ['blink', 'left', 'right', 'mouth'];

        function startScanningProcess() {
            const instruction = document.getElementById('scanInstruction');
            const steps = document.getElementById('scanSteps').children;
            
            function nextStep() {
                if (scanStep < scanSteps.length) {
                    // Update instruction
                    const stepTexts = {
                        'blink': 'မျက်တောင်ခတ်ပါ',
                        'left': 'ဘယ်ဘက်လှည့်ပါ',
                        'right': 'ညာဘက်လှည့်ပါ',
                        'mouth': 'ပါးစပ်ဖွင့်ပါ'
                    };
                    
                    instruction.textContent = stepTexts[scanSteps[scanStep]];
                    
                    // Mark current step as active
                    Array.from(steps).forEach((step, index) => {
                        step.style.color = index === scanStep ? '#7c3aed' : '#6b7280';
                        step.style.fontWeight = index === scanStep ? 'bold' : 'normal';
                    });
                    
                    // Simulate step completion after 3 seconds
                    setTimeout(() => {
                        steps[scanStep].innerHTML = steps[scanStep].innerHTML.replace('•', '✓');
                        scanStep++;
                        
                        if (scanStep < scanSteps.length) {
                            nextStep();
                        } else {
                            completeFaceScan();
                        }
                    }, 3000);
                }
            }
            
            nextStep();
        }

        function completeFaceScan() {
            const instruction = document.getElementById('scanInstruction');
            instruction.textContent = 'မျက်နှာစကင်န် အောင်မြင်ပါတယ်!';
            instruction.style.color = '#10b981';
            
            // Stop camera
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            // Enable submit button
            document.getElementById('submitKyc').disabled = false;
            
            // Store scan data (in real app, this would be actual biometric data)
            faceScanData = {
                completed: true,
                timestamp: new Date().toISOString(),
                steps: scanSteps
            };
        }

        // KYC Form Submit
        document.getElementById('kycForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!faceScanData) {
                showNotification('မျက်နှာစကင်န် ဖတ်ပါ', 'error');
                return;
            }
            
            const formData = new FormData(e.target);
            
            try {
                let idImages = [];
                
                if (document.getElementById('kycIdType').value === 'NRC') {
                    const frontFile = document.getElementById('nrcFront').files[0];
                    const backFile = document.getElementById('nrcBack').files[0];
                    
                    if (frontFile && backFile) {
                        const frontUrl = await uploadSingleFile(frontFile);
                        const backUrl = await uploadSingleFile(backFile);
                        idImages = [frontUrl, backUrl];
                    }
                }
                
                const { error } = await supabase
                    .from('kyc_submissions')
                    .upsert([{
                        user_id: currentUser.id,
                        full_name: document.getElementById('kycName').value,
                        birthdate: document.getElementById('kycBirthdate').value,
                        phone: document.getElementById('kycPhone').value,
                        address: document.getElementById('kycAddress').value,
                        id_type: document.getElementById('kycIdType').value,
                        id_images: JSON.stringify(idImages),
                        face_scan_data: JSON.stringify(faceScanData),
                        status: 'pending',
                        submitted_at: new Date().toISOString()
                    }]);

                if (error) throw error;
                
                closeModal('kycModal');
                showNotification('KYC တင်ခြင်း အောင်မြင်ပါတယ်', 'success');
                await loadKYCStatus();
                
                // Reset form
                e.target.reset();
                faceScanData = null;
                scanStep = 0;
                document.getElementById('faceScanSection').style.display = 'none';
                document.getElementById('submitKyc').disabled = true;
            } catch (error) {
                console.error('Error submitting KYC:', error);
                showNotification('KYC တင်ခြင်း မအောင်မြင်ပါ', 'error');
            }
        });

        // Seller Functions
        async function checkSellerStatus() {
            try {
                const { data: kyc } = await supabase
                    .from('kyc_submissions')
                    .select('status')
                    .eq('user_id', currentUser.id)
                    .eq('status', 'approved')
                    .single();

                if (kyc) {
                    document.getElementById('sellerTab').style.display = 'block';
                    await loadMyProducts();
                    await loadMyPayments();
                    await loadMyOrders();
                }
            } catch (error) {
                // User is not approved seller
            }
        }

        function showSellerSection(section) {
            // Hide all sections
            const sections = document.querySelectorAll('.seller-section');
            sections.forEach(s => s.style.display = 'none');
            
            // Show selected section
            document.getElementById('seller' + section.charAt(0).toUpperCase() + section.slice(1).replace('-', '')).style.display = 'block';
            
            // Update nav buttons
            const navBtns = document.querySelectorAll('.seller-nav-btn');
            navBtns.forEach(btn => {
                btn.classList.remove('bg-purple-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-purple-600', 'text-white');
        }

        async function loadMyProducts() {
            try {
                const { data: products, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('seller_id', currentUser.id);

                if (error) throw error;

                const container = document.getElementById('myProductsList');
                container.innerHTML = '';

                if (products.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-8 col-span-full">Product မရှိပါသေးပါ</p>';
                    return;
                }

                products.forEach(product => {
                    const productDiv = createMyProductCard(product);
                    container.appendChild(productDiv);
                });
            } catch (error) {
                console.error('Error loading my products:', error);
            }
        }

        function createMyProductCard(product) {
            const div = document.createElement('div');
            div.className = 'bg-gray-50 rounded-lg p-4';
            
            const images = product.images ? JSON.parse(product.images) : [];
            const mainImage = images.length > 0 ? images[0] : 'https://via.placeholder.com/100';
            
            div.innerHTML = `
                <div class="flex items-center space-x-4">
                    <img src="${mainImage}" alt="${product.name}" class="w-16 h-16 object-cover rounded-lg">
                    <div class="flex-1">
                        <h4 class="font-semibold">${product.name}</h4>
                        <p class="text-purple-600 font-bold">${product.price.toLocaleString()} MMK</p>
                        <p class="text-sm text-gray-600">${product.status === 'active' ? 'Active' : 'Sold Out'}</p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editProduct(${product.id})" class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteProduct(${product.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                        ${product.status === 'active' ? `
                            <button onclick="markSoldOut(${product.id})" class="text-orange-600 hover:text-orange-800" title="Sold Out သတ်မှတ်ရန်">
                                <i class="fas fa-ban"></i>
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            return div;
        }

        // Product file handling
        function handleProductFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/') || file.type.startsWith('video/')) {
                    currentProductFiles.push(file);
                }
            });
            displayProductFilePreview();
        }

        function displayProductFilePreview() {
            const preview = document.getElementById('productFilePreview');
            preview.innerHTML = '';
            
            currentProductFiles.forEach((file, index) => {
                const div = document.createElement('div');
                div.className = 'relative';
                
                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'preview-image';
                    div.appendChild(img);
                } else if (file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.className = 'preview-image';
                    video.controls = true;
                    div.appendChild(video);
                }
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '×';
                deleteBtn.onclick = () => removeProductFile(index);
                
                div.appendChild(deleteBtn);
                preview.appendChild(div);
            });
        }

        function removeProductFile(index) {
            currentProductFiles.splice(index, 1);
            displayProductFilePreview();
        }

        // Add Product Form Submit
        document.getElementById('addProductForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (currentProductFiles.length === 0) {
                showNotification('Product ဖိုင်များ ထည့်ပါ', 'error');
                return;
            }
            
            try {
                // Upload files
                const uploadedFiles = await uploadMultipleFiles(currentProductFiles);
                const images = uploadedFiles.filter(file => file.type === 'image');
                const videos = uploadedFiles.filter(file => file.type === 'video');
                
                const { error } = await supabase
                    .from('products')
                    .insert([{
                        seller_id: currentUser.id,
                        name: document.getElementById('productName').value,
                        description: document.getElementById('productDescription').value,
                        price: parseInt(document.getElementById('productPrice').value),
                        game: document.getElementById('productGame').value,
                        social_platform: document.getElementById('productSocial').value,
                        contact_social_name: document.getElementById('contactSocialName').value,
                        contact_social_link: document.getElementById('contactSocialLink').value,
                        images: JSON.stringify(images.map(f => f.url)),
                        videos: JSON.stringify(videos.map(f => f.url)),
                        status: 'active',
                        created_at: new Date().toISOString()
                    }]);

                if (error) throw error;
                
                showNotification('Product တင်ခြင်း အောင်မြင်ပါတယ်', 'success');
                e.target.reset();
                currentProductFiles = [];
                displayProductFilePreview();
                await loadMyProducts();
                await loadProducts(); // Refresh main products
                showSellerSection('products');
            } catch (error) {
                console.error('Error adding product:', error);
                showNotification('Product တင်ခြင်း မအောင်မြင်ပါ', 'error');
            }
        });

        async function markSoldOut(productId) {
            try {
                const { error } = await supabase
                    .from('products')
                    .update({ 
                        sold_out: true,
                        buyer_username: currentUser.username,
                        status: 'sold'
                    })
                    .eq('id', productId);

                if (error) throw error;
                
                showNotification('Product ကို Sold Out သတ်မှတ်ပြီးပါပြီ', 'success');
                await loadMyProducts();
                await loadProducts();
            } catch (error) {
                console.error('Error marking sold out:', error);
                showNotification('Sold Out သတ်မှတ်ခြင်း မအောင်မြင်ပါ', 'error');
            }
        }

        async function deleteProduct(productId) {
            if (confirm('Product ကို ဖျက်မလား?')) {
                try {
                    const { error } = await supabase
                        .from('products')
                        .delete()
                        .eq('id', productId);

                    if (error) throw error;
                    
                    showNotification('Product ဖျက်ခြင်း အောင်မြင်ပါတယ်', 'success');
                    await loadMyProducts();
                    await loadProducts();
                } catch (error) {
                    console.error('Error deleting product:', error);
                    showNotification('Product ဖျက်ခြင်း မအောင်မြင်ပါ', 'error');
                }
            }
        }

        // Payment Functions
        async function loadMyPayments() {
            try {
                const { data: payments, error } = await supabase
                    .from('user_payments')
                    .select('*')
                    .eq('user_id', currentUser.id);

                if (error) throw error;

                const container = document.getElementById('myPaymentsList');
                container.innerHTML = '';

                if (payments.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">Payment စနစ် မရှိပါသေးပါ</p>';
                    return;
                }

                payments.forEach(payment => {
                    const paymentDiv = createMyPaymentCard(payment);
                    container.appendChild(paymentDiv);
                });
            } catch (error) {
                console.error('Error loading my payments:', error);
            }
        }

        function createMyPaymentCard(payment) {
            const div = document.createElement('div');
            div.className = 'flex items-center space-x-4 p-4 bg-gray-50 rounded-lg';
            
            div.innerHTML = `
                <img src="${payment.icon_url}" alt="${payment.name}" class="w-12 h-12 rounded">
                <div class="flex-1">
                    <h4 class="font-semibold">${payment.name}</h4>
                    <p class="text-sm text-gray-600">${payment.address}</p>
                </div>
                <div class="flex space-x-2">
                    <button onclick="editPayment(${payment.id})" class="text-blue-600 hover:text-blue-800">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="deletePayment(${payment.id})" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            return div;
        }

        function showAddPaymentModal() {
            document.getElementById('addPaymentModal').style.display = 'block';
        }

        // Add Payment Form Submit
        document.getElementById('addPaymentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const iconFile = document.getElementById('paymentIcon').files[0];
            const qrFile = document.getElementById('paymentQr').files[0];
            
            if (!iconFile || !qrFile) {
                showNotification('Icon နဲ့ QR Code ထည့်ပါ', 'error');
                return;
            }
            
            try {
                const iconUrl = await uploadSingleFile(iconFile);
                const qrUrl = await uploadSingleFile(qrFile);
                
                const { error } = await supabase
                    .from('user_payments')
                    .insert([{
                        user_id: currentUser.id,
                        name: document.getElementById('paymentName').value,
                        description: document.getElementById('paymentDescription').value,
                        address: document.getElementById('paymentAddress').value,
                        icon_url: iconUrl,
                        qr_code_url: qrUrl,
                        created_at: new Date().toISOString()
                    }]);

                if (error) throw error;
                
                closeModal('addPaymentModal');
                showNotification('Payment စနစ် ထည့်ခြင်း အောင်မြင်ပါတယ်', 'success');
                e.target.reset();
                await loadMyPayments();
            } catch (error) {
                console.error('Error adding payment:', error);
                showNotification('Payment စနစ် ထည့်ခြင်း မအောင်မြင်ပါ', 'error');
            }
        });

        async function deletePayment(paymentId) {
            if (confirm('Payment စနစ်ကို ဖျက်မလား?')) {
                try {
                    const { error } = await supabase
                        .from('user_payments')
                        .delete()
                        .eq('id', paymentId);

                    if (error) throw error;
                    
                    showNotification('Payment စနစ် ဖျက်ခြင်း အောင်မြင်ပါတယ်', 'success');
                    await loadMyPayments();
                } catch (error) {
                    console.error('Error deleting payment:', error);
                    showNotification('Payment စနစ် ဖျက်ခြင်း မအောင်မြင်ပါ', 'error');
                }
            }
        }

        // My Orders Functions
        async function loadMyOrders() {
            try {
                const { data: orders, error } = await supabase
                    .from('orders')
                    .select(`
                        *,
                        products (name, price),
                        users!orders_buyer_id_fkey (name, username, profile_image)
                    `)
                    .in('product_id', await getMyProductIds())
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const container = document.getElementById('myOrdersList');
                container.innerHTML = '';

                if (orders.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-8">Order မရှိပါသေးပါ</p>';
                    return;
                }

                orders.forEach(order => {
                    const orderDiv = createMyOrderCard(order);
                    container.appendChild(orderDiv);
                });
            } catch (error) {
                console.error('Error loading my orders:', error);
            }
        }

        async function getMyProductIds() {
            const { data: products } = await supabase
                .from('products')
                .select('id')
                .eq('seller_id', currentUser.id);
            
            return products ? products.map(p => p.id) : [];
        }

        function createMyOrderCard(order) {
            const div = document.createElement('div');
            div.className = 'bg-white border rounded-lg p-4';
            
            const proofImages = order.proof_images ? JSON.parse(order.proof_images) : [];
            
            div.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <img src="${order.users.profile_image || 'https://via.placeholder.com/40'}" alt="Buyer" class="w-10 h-10 rounded-full">
                            <div>
                                <h4 class="font-semibold">${order.users.name}</h4>
                                <p class="text-sm text-gray-600">@${order.users.username}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="font-bold">${order.products.name}</p>
                            <p class="text-purple-600 font-bold">${order.products.price.toLocaleString()} MMK</p>
                        </div>
                    </div>
                    
                    ${proofImages.length > 0 ? `
                        <div>
                            <h5 class="font-semibold mb-2">ငွေလွှဲ ပြေစာများ:</h5>
                            <div class="grid grid-cols-4 gap-2">
                                ${proofImages.map(img => `<img src="${img}" class="w-full h-16 object-cover rounded cursor-pointer" onclick="window.open('${img}', '_blank')">`).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${order.status === 'pending' ? `
                        <div class="flex space-x-2">
                            <button onclick="approveOrder(${order.id})" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg font-medium">
                                <i class="fas fa-check mr-2"></i>အတည်ပြုရန်
                            </button>
                            <button onclick="rejectOrder(${order.id})" class="flex-1 bg-red-600 text-white py-2 px-4 rounded-lg font-medium">
                                <i class="fas fa-times mr-2"></i>ငြင်းဆိုရန်
                            </button>
                        </div>
                    ` : `
                        <div class="text-center py-2">
                            <span class="px-4 py-2 rounded-full text-sm font-medium ${order.status === 'confirmed' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${order.status === 'confirmed' ? 'အတည်ပြုပြီး' : 'ငြင်းဆိုပြီး'}
                            </span>
                        </div>
                    `}
                </div>
            `;
            
            return div;
        }

        async function approveOrder(orderId) {
            // Show upload receipt modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2 class="text-2xl font-bold mb-4">Order Receipt တင်ရန်</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Receipt ပုံ</label>
                            <input type="file" id="receiptFile" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="uploadReceipt(${orderId})" class="flex-1 btn-gradient text-white py-2 px-4 rounded-lg font-medium">
                                <i class="fas fa-upload mr-2"></i>တင်ပြီး အတည်ပြုရန်
                            </button>
                            <button onclick="this.closest('.modal').remove()" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-lg font-medium">
                                ပယ်ဖျက်ရန်
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function uploadReceipt(orderId) {
            const file = document.getElementById('receiptFile').files[0];
            if (!file) {
                showNotification('Receipt ပုံ ရွေးချယ်ပါ', 'error');
                return;
            }
            
            try {
                const receiptUrl = await uploadSingleFile(file);
                
                const { error } = await supabase
                    .from('orders')
                    .update({ 
                        status: 'confirmed',
                        receipt_url: receiptUrl,
                        confirmed_at: new Date().toISOString()
                    })
                    .eq('id', orderId);

                if (error) throw error;
                
                document.querySelector('.modal').remove();
                showNotification('Order အတည်ပြုခြင်း အောင်မြင်ပါတယ်', 'success');
                await loadMyOrders();
            } catch (error) {
                console.error('Error approving order:', error);
                showNotification('Order အတည်ပြုခြင်း မအောင်မြင်ပါ', 'error');
            }
        }

        async function rejectOrder(orderId) {
            if (confirm('Order ကို ငြင်းဆိုမလား?')) {
                try {
                    const { error } = await supabase
                        .from('orders')
                        .update({ 
                            status: 'rejected',
                            rejected_at: new Date().toISOString()
                        })
                        .eq('id', orderId);

                    if (error) throw error;
                    
                    showNotification('Order ငြင်းဆိုခြင်း အောင်မြင်ပါတယ်', 'success');
                    await loadMyOrders();
                } catch (error) {
                    console.error('Error rejecting order:', error);
                    showNotification('Order ငြင်းဆိုခြင်း မအောင်မြင်ပါ', 'error');
                }
            }
        }

        // Profile Functions
        async function updateProfile() {
            const name = document.getElementById('editName').value;
            const email = document.getElementById('editEmail').value;
            const username = document.getElementById('editUsername').value;
            const password = document.getElementById('editPassword').value;
            
            if (!name || !email || !username) {
                showNotification('အဓိက အချက်အလက်များ ဖြည့်သွင်းပါ', 'error');
                return;
            }
            
            // Check if email or username already exists (excluding current user)
            if (email !== currentUser.email || username !== currentUser.username) {
                try {
                    const { data: existingUsers } = await supabase
                        .from('users')
                        .select('*')
                        .or(`email.eq.${email},username.eq.${username}`)
                        .neq('id', currentUser.id);

                    if (existingUsers && existingUsers.length > 0) {
                        showNotification('Gmail လိပ်စာ သို့မဟုတ် Username ရှိပြီးသားဖြစ်ပါတယ်', 'error');
                        return;
                    }
                } catch (error) {
                    console.error('Error checking existing users:', error);
                }
            }
            
            try {
                const updateData = {
                    name: name,
                    email: email,
                    username: username,
                    updated_at: new Date().toISOString()
                };
                
                if (password) {
                    updateData.password = password;
                }
                
                const { error } = await supabase
                    .from('users')
                    .update(updateData)
                    .eq('id', currentUser.id);

                if (error) throw error;
                
                // Update current user object
                currentUser = { ...currentUser, ...updateData };
                
                // Update UI
                document.getElementById('userDisplayName').textContent = name;
                document.getElementById('userDisplayEmail').textContent = email;
                document.getElementById('profileName').textContent = name;
                document.getElementById('profileEmail').textContent = email;
                document.getElementById('profileUsername').textContent = username;
                
                // Clear password field
                document.getElementById('editPassword').value = '';
                
                showNotification('Profile ပြင်ဆင်ခြင်း အောင်မြင်ပါတယ်', 'success');
            } catch (error) {
                console.error('Error updating profile:', error);
                showNotification('Profile ပြင်ဆင်ခြင်း မအောင်မြင်ပါ', 'error');
            }
        }

        function changeProfileImage() {
            document.getElementById('profileImageModal').style.display = 'block';
            
            document.getElementById('profileImageFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (!file.type.startsWith('image/') && !file.type.includes('gif')) {
                        showNotification('ပုံ သို့မဟုတ် GIF ဖိုင်သာ လက်ခံပါတယ်', 'error');
                        return;
                    }
                    
                    const preview = document.getElementById('profileImagePreview');
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'w-32 h-32 rounded-full object-cover mx-auto';
                    preview.innerHTML = '';
                    preview.appendChild(img);
                }
            });
        }

        async function uploadProfileImage() {
            const file = document.getElementById('profileImageFile').files[0];
            if (!file) {
                showNotification('ပုံ ရွေးချယ်ပါ', 'error');
                return;
            }
            
            try {
                const imageUrl = await uploadSingleFile(file);
                
                const { error } = await supabase
                    .from('users')
                    .update({ 
                        profile_image: imageUrl,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);

                if (error) throw error;
                
                // Update UI
                currentUser.profile_image = imageUrl;
                document.getElementById('userAvatar').src = imageUrl;
                document.getElementById('profileImage').src = imageUrl;
                
                closeModal('profileImageModal');
                showNotification('Profile ပုံ ပြောင်းခြင်း အောင်မြင်ပါတယ်', 'success');
            } catch (error) {
                console.error('Error uploading profile image:', error);
                showNotification('Profile ပုံ တင်ခြင်း မအောင်မြင်ပါ', 'error');
            }
        }

        // About Functions
        async function loadAboutData() {
            try {
                const { data: aboutLinks, error } = await supabase
                    .from('about_links')
                    .select('*');

                if (error) throw error;

                const container = document.getElementById('aboutSection');
                
                if (!aboutLinks || aboutLinks.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-4">About အချက်အလက် မရှိပါသေးပါ</p>';
                    return;
                }

                container.innerHTML = `
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        ${aboutLinks.map(link => `
                            <a href="${link.url}" target="_blank" class="flex flex-col items-center space-y-2 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                <i class="fab fa-${link.platform.toLowerCase()} text-2xl text-purple-600"></i>
                                <span class="text-sm font-medium text-gray-700">${link.platform}</span>
                            </a>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Error loading about data:', error);
            }
        }

        // Website Logo Functions
        async function loadWebsiteLogo() {
            try {
                const { data: settings, error } = await supabase
                    .from('website_settings')
                    .select('logo_url')
                    .single();

                if (error) throw error;

                if (settings && settings.logo_url) {
                    document.getElementById('websiteLogo').innerHTML = `<img src="${settings.logo_url}" alt="Logo" class="w-16 h-16 mx-auto rounded-lg">`;
                    document.getElementById('dashboardLogo').innerHTML = `<img src="${settings.logo_url}" alt="Logo" class="w-12 h-12 rounded-lg">`;
                }
            } catch (error) {
                // Use default logo
            }
        }

        // File Upload Functions
        async function uploadSingleFile(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
            
            const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/auto/upload`, {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            return data.secure_url;
        }

        async function uploadMultipleFiles(files) {
            const uploadPromises = files.map(async (file) => {
                const url = await uploadSingleFile(file);
                return {
                    url: url,
                    type: file.type.startsWith('image/') ? 'image' : 'video'
                };
            });
            
            return Promise.all(uploadPromises);
        }

        // Utility Functions
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Close user menu when clicking outside
            if (!event.target.closest('#userAvatar') && !event.target.closest('#userMenu')) {
                document.getElementById('userMenu').classList.add('hidden');
            }
        }
    </script>
</body>
</html>
