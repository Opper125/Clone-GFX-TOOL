<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>FPS GFX Tool - Admin</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Share+Tech+Mono&family=Noto+Sans+Myanmar:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Custom Fonts */
body {
  font-family: 'Noto Sans Myanmar', 'Inter', sans-serif;
}
h1, h2, h3, .font-orbitron {
  font-family: 'Orbitron', sans-serif;
}
.font-share-tech {
  font-family: 'Share Tech Mono', monospace;
}

/* New Color Palette */
:root {
  --primary-bg: hsl(220 20% 8%); /* Deep Dark Blue-Grey */
  --secondary-bg: hsl(220 20% 12%); /* Slightly Lighter Dark Blue-Grey */
  --accent-purple: hsl(280 80% 60%); /* Vibrant Purple */
  --accent-green: hsl(160 80% 50%); /* Neon Green */
  --accent-red: hsl(0 80% 60%); /* Vibrant Red */
  --text-primary: hsl(220 20% 90%); /* Light Grey */
  --text-secondary: hsl(220 15% 60%); /* Medium Grey */
  --border-color: hsl(220 15% 20%); /* Dark Grey */
  --card-bg: rgba(20, 25, 35, 0.7); /* Dark Translucent */
  --input-bg: rgba(30, 35, 45, 0.6); /* Darker Translucent */
  --table-header-bg: rgba(var(--accent-purple-rgb), 0.15);
  --table-row-hover-bg: rgba(var(--accent-purple-rgb), 0.08);

  /* RGB values for easier use in rgba() */
  --accent-purple-rgb: 199, 56, 255; /* From hsl(280 80% 60%) */
  --accent-green-rgb: 0, 204, 136; /* From hsl(160 80% 50%) */
  --accent-red-rgb: 255, 51, 51; /* From hsl(0 80% 60%) */
}

body {
  background: linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 100%);
  min-height: 100vh;
  position: relative;
  overflow-x: hidden;
  color: var(--text-primary);
}

.myanmar-pattern {
  background-image: 
    radial-gradient(circle at 25% 25%, rgba(var(--accent-purple-rgb), 0.15) 0%, transparent 50%),
    radial-gradient(circle at 75% 75%, rgba(var(--accent-green-rgb), 0.15) 0%, transparent 50%),
    radial-gradient(circle at 50% 50%, rgba(var(--accent-red-rgb), 0.1) 0%, transparent 50%);
  animation: patternMove 25s ease-in-out infinite;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: -2;
}

@keyframes patternMove {
  0%, 100% { background-position: 0% 0%, 100% 100%, 50% 50%; }
  33% { background-position: 100% 100%, 0% 0%, 75% 25%; }
  66% { background-position: 50% 50%, 75% 25%, 25% 75%; }
}

.myanmar-waves {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 80px;
  background: linear-gradient(45deg, 
    rgba(var(--accent-purple-rgb), 0.2), 
    rgba(var(--accent-green-rgb), 0.2), 
    rgba(var(--accent-red-rgb), 0.2));
  clip-path: polygon(0 100%, 0 60%, 25% 40%, 50% 60%, 75% 30%, 100% 50%, 100% 100%);
  animation: waveFloat 12s ease-in-out infinite;
  z-index: -1;
}

@keyframes waveFloat {
  0%, 100% { transform: translateY(0px) scaleY(1); }
  50% { transform: translateY(-10px) scaleY(1.1); }
}

.app-card {
  backdrop-filter: blur(20px);
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  box-shadow: 
    0 20px 40px -12px rgba(0, 0, 0, 0.8),
    0 0 0 1px rgba(var(--accent-purple-rgb), 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.05);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 16px;
}

.app-card:hover {
  transform: translateY(-2px);
  box-shadow: 
    0 25px 50px -12px rgba(var(--accent-purple-rgb), 0.25),
    0 0 0 1px rgba(var(--accent-purple-rgb), 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  border-color: rgba(var(--accent-purple-rgb), 0.5);
}

.myanmar-btn {
  background: linear-gradient(135deg, var(--accent-purple), var(--accent-green));
  color: #000;
  font-weight: 700;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  border: none;
  border-radius: 12px;
  padding: 12px 20px;
  cursor: pointer;
  box-shadow: 0 5px 15px rgba(var(--accent-purple-rgb), 0.2);
}

.myanmar-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
  transition: left 0.6s ease;
}

.myanmar-btn:hover::before {
  left: 100%;
}

.myanmar-btn:hover {
  background: linear-gradient(135deg, var(--accent-green), var(--accent-purple));
  transform: translateY(-1px);
  box-shadow: 0 10px 25px rgba(var(--accent-green-rgb), 0.4);
}

.btn-danger {
  background: linear-gradient(135deg, var(--accent-red), #FF6B6B);
  color: white;
  box-shadow: 0 5px 15px rgba(var(--accent-red-rgb), 0.2);
}

.btn-danger:hover {
  background: linear-gradient(135deg, #FF6B6B, var(--accent-red));
  box-shadow: 0 10px 25px rgba(var(--accent-red-rgb), 0.4);
}

.connection-status {
  position: fixed;
  top: 15px;
  right: 15px;
  z-index: 1000;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  backdrop-filter: blur(10px);
  animation: statusPulse 2s infinite;
  color: var(--text-primary);
}

.status-online {
  background: linear-gradient(135deg, var(--accent-green), #4ADE80);
  color: white;
  box-shadow: 0 0 20px rgba(var(--accent-green-rgb), 0.5);
}

.status-offline {
  background: linear-gradient(135deg, var(--accent-red), #EF4444);
  color: white;
  animation: statusShake 0.5s ease-in-out;
}

.status-connecting {
  background: linear-gradient(135deg, var(--accent-purple), #FCD34D);
  color: #000;
  animation: statusSpin 1s linear infinite;
}

@keyframes statusPulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.8; transform: scale(1.05); }
}

@keyframes statusShake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-3px); }
  75% { transform: translateX(3px); }
}

@keyframes statusSpin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.stats-card {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  border-radius: 12px;
}

.stats-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-purple), var(--accent-green), var(--accent-red));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.stats-card:hover::before {
  opacity: 1;
}

.stats-card:hover {
  transform: translateY(-3px) scale(1.02);
  box-shadow: 0 15px 35px rgba(var(--accent-purple-rgb), 0.2);
  border-color: rgba(var(--accent-purple-rgb), 0.3);
}

.app-input {
  background: var(--input-bg);
  border: 2px solid var(--border-color);
  backdrop-filter: blur(10px);
  color: var(--text-primary);
  transition: all 0.3s ease;
  border-radius: 12px;
  padding: 12px 16px;
}

.app-input:focus {
  border-color: var(--accent-purple);
  background: rgba(30, 35, 45, 0.8);
  outline: none;
  box-shadow: 0 0 25px rgba(var(--accent-purple-rgb), 0.3);
}

.app-input::placeholder {
  color: var(--text-secondary);
}

.app-table {
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  overflow: hidden;
}

.app-table th {
  background: var(--table-header-bg);
  color: var(--accent-purple);
  font-weight: 700;
  text-transform: uppercase;
  font-size: 12px;
  letter-spacing: 0.5px;
  padding: 12px 8px;
}

.app-table td {
  padding: 12px 8px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  color: var(--text-primary);
}

.app-table tr:hover {
  background: var(--table-row-hover-bg);
}

.loading-spinner {
  border: 3px solid rgba(var(--accent-purple-rgb), 0.3);
  border-top: 3px solid var(--accent-purple);
  border-radius: 50%;
  width: 24px;
  height: 24px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.notification {
  position: fixed;
  top: 70px;
  right: 15px;
  left: 15px;
  max-width: 400px;
  margin: 0 auto;
  padding: 12px 16px;
  border-radius: 10px;
  color: white;
  font-weight: 600;
  z-index: 1001;
  animation: slideInRight 0.4s ease-out;
  backdrop-filter: blur(15px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

.nav-btn {
  transition: all 0.3s ease;
  position: relative;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 14px;
  color: var(--text-secondary);
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.nav-btn.active {
  background: linear-gradient(135deg, var(--accent-purple), var(--accent-green)) !important;
  color: #000 !important;
  box-shadow: 0 5px 15px rgba(var(--accent-purple-rgb), 0.4);
  border-color: var(--accent-purple) !important;
}

.nav-btn:not(.active):hover {
  background: rgba(var(--accent-purple-rgb), 0.1);
  color: var(--accent-purple);
  border-color: rgba(var(--accent-purple-rgb), 0.3);
}

.fade-in {
  animation: fadeInUp 0.6s ease-out forwards;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.status-active { color: var(--accent-green); }
.status-inactive { color: var(--accent-red); }
.status-banned { color: var(--accent-red); }

.news-card {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  transition: all 0.3s ease;
  margin-bottom: 16px;
}

.news-card:hover {
  border-color: rgba(var(--accent-purple-rgb), 0.3);
  transform: translateY(-2px);
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  padding: 20px;
}

.modal-content {
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 24px;
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
  backdrop-filter: blur(20px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

/* Mobile optimizations */
@media (max-width: 768px) {
  .container { padding: 8px; }
  .app-card { padding: 16px; margin: 8px; }
  .connection-status { top: 10px; right: 10px; font-size: 9px; padding: 6px 12px; }
  .notification { top: 50px; right: 10px; left: 10px; max-width: none; }
  .stats-card { margin-bottom: 12px; }
  .myanmar-btn { padding: 10px 16px; font-size: 14px; }
  .app-table { font-size: 12px; }
  .app-table th, .app-table td { padding: 8px 4px; }
  h1 { font-size: 20px; }
  h2 { font-size: 18px; }
  h3 { font-size: 16px; }
  .nav-btn { padding: 6px 10px; font-size: 12px; margin: 2px; }
  .modal-content { padding: 16px; max-width: 95vw; }
}

@media (max-width: 480px) {
  .myanmar-pattern { opacity: 0.7; }
  .myanmar-waves { height: 60px; }
  .app-card { padding: 12px; margin: 4px; }
  .grid { gap: 8px; }
  .stats-card { padding: 12px; }
  .app-table th, .app-table td { padding: 6px 2px; font-size: 11px; }
}

/* Scrollbar styling */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); }
::-webkit-scrollbar-thumb { background: var(--accent-purple); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--accent-green); }

/* Loading overlay */
.loading-overlay {
  backdrop-filter: blur(8px);
  background: rgba(0,0,0,0.7);
}

.btn-small {
  padding: 6px 12px;
  font-size: 12px;
  border-radius: 8px;
}

.table-actions {
  display: flex;
  gap: 4px;
  flex-wrap: wrap;
}

.hidden { display: none !important; }

/* Search input specific styles */
.search-input-container {
  position: relative;
}
.search-input-container .app-input {
  padding-left: 40px; /* Space for icon */
}
.search-input-container .search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary);
  pointer-events: none;
}
</style>
</head>
<body class="text-white">
<div class="myanmar-pattern"></div>
<div class="myanmar-waves"></div>

 Connection Status 
<div id="connection-status" class="connection-status status-connecting">
<i class="fas fa-wifi"></i> ချိတ်ဆက်နေသည်...
</div>

 Main Container 
<div class="container mx-auto px-2 py-4 max-w-6xl">
 Header 
<div class="text-center mb-6 fade-in">
  <h1 class="text-2xl md:text-3xl lg:text-4xl font-orbitron font-bold mb-2 text-accent-purple">
    <i class="fas fa-shield-alt mr-2"></i>
    FPS GFX Tool
  </h1>
  <h2 class="text-lg md:text-xl lg:text-2xl font-orbitron font-semibold text-accent-green mb-2">
    ADMIN DASHBOARD
  </h2>
  <div class="inline-block px-4 py-2 bg-gradient-to-r from-accent-purple to-accent-green text-black rounded-full font-bold text-sm">
    <i class="fas fa-user-shield mr-1"></i> ADMIN INTERFACE
  </div>
</div>

 Notification Container 
<div id="notification-container"></div>

 Login Section 
<div id="login-section" class="max-w-md mx-auto fade-in">
  <div class="app-card p-6">
    <h3 class="text-xl md:text-2xl font-orbitron font-bold text-center mb-6 text-accent-purple">
      <i class="fas fa-user-shield mr-2"></i>
      ADMIN LOGIN
    </h3>
    <div class="space-y-4">
      <div class="relative search-input-container">
        <input 
          type="text" 
          id="admin-username" 
          placeholder="Admin Username" 
          class="app-input w-full"
        >
        <i class="fas fa-user search-icon"></i>
      </div>
      <div class="relative search-input-container">
        <input 
          type="password" 
          id="admin-password" 
          placeholder="Admin Password" 
          class="app-input w-full"
        >
        <i class="fas fa-lock search-icon"></i>
      </div>
      <button 
        onclick="adminLogin()" 
        id="admin-login-btn"
        class="myanmar-btn w-full flex items-center justify-center space-x-2"
      >
        <i class="fas fa-sign-in-alt"></i>
        <span id="admin-login-text">LOGIN</span>
      </button>
    </div>
  </div>
</div>

 Main Admin Content 
<div id="admin-content" class="hidden">
   Navigation 
  <div class="flex flex-wrap justify-center gap-2 md:gap-4 mb-6">
    <button onclick="showSection('dashboard', this)" class="nav-btn active">
      <i class="fas fa-tachometer-alt mr-1"></i>
      <span class="hidden sm:inline">DASHBOARD</span>
      <span class="sm:hidden">Dash</span>
    </button>
    <button onclick="showSection('keys', this)" class="nav-btn">
      <i class="fas fa-key mr-1"></i>
      <span class="hidden sm:inline">KEYS</span>
      <span class="sm:hidden">Keys</span>
    </button>
    <button onclick="showSection('users', this)" class="nav-btn">
      <i class="fas fa-users mr-1"></i>
      <span class="hidden sm:inline">USERS</span>
      <span class="sm:hidden">Users</span>
    </button>
    <button onclick="showSection('news', this)" class="nav-btn">
      <i class="fas fa-newspaper mr-1"></i>
      <span class="hidden sm:inline">NEWS</span>
      <span class="sm:hidden">News</span>
    </button>
    <button onclick="showSection('products', this)" class="nav-btn">
      <i class="fas fa-box-open mr-1"></i>
      <span class="hidden sm:inline">PRODUCTS</span>
      <span class="sm:hidden">Products</span>
    </button>
    <button onclick="showSection('user-products', this)" class="nav-btn">
      <i class="fas fa-store mr-1"></i>
      <span class="hidden sm:inline">USER PRODUCTS</span>
      <span class="sm:hidden">User Shop</span>
    </button>
    <button onclick="showSection('orders', this)" class="nav-btn">
      <i class="fas fa-receipt mr-1"></i>
      <span class="hidden sm:inline">ORDERS</span>
      <span class="sm:hidden">Orders</span>
    </button>
    <button onclick="showSection('payment-methods', this)" class="nav-btn">
      <i class="fas fa-wallet mr-1"></i>
      <span class="hidden sm:inline">PAYMENT METHODS</span>
      <span class="sm:hidden">Payments</span>
    </button>
    <button onclick="showSection('chat', this)" class="nav-btn">
      <i class="fas fa-comments mr-1"></i>
      <span class="hidden sm:inline">CHAT</span>
      <span class="sm:hidden">Chat</span>
    </button>
    <button onclick="showSection('support', this)" class="nav-btn">
      <i class="fas fa-headset mr-1"></i>
      <span class="hidden sm:inline">SUPPORT</span>
      <span class="sm:hidden">Support</span>
    </button>
    <button onclick="showSection('about', this)" class="nav-btn">
      <i class="fas fa-info-circle mr-1"></i>
      <span class="hidden sm:inline">ABOUT</span>
      <span class="sm:hidden">About</span>
    </button>
    <button onclick="adminLogout()" class="nav-btn btn-danger">
      <i class="fas fa-sign-out-alt mr-1"></i>
      <span class="hidden sm:inline">LOGOUT</span>
      <span class="sm:hidden">Logout</span>
    </button>
  </div>

   Dashboard Section 
  <div id="dashboard-section" class="admin-section">
    <div class="app-card p-4 md:p-8 text-center">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-4 text-accent-purple">
        <i class="fas fa-tachometer-alt mr-2"></i>
        ADMIN DASHBOARD OVERVIEW
      </h3>
      <p class="text-text-secondary">
        Welcome, Admin! Here's a quick overview of your system.
      </p>
      <div class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div class="stats-card p-4">
          <i class="fas fa-key text-2xl text-blue-400 mb-2"></i>
          <h4 class="text-sm font-semibold text-text-secondary">TOTAL KEYS</h4>
          <p id="total-keys" class="text-lg font-bold text-accent-purple">0</p>
        </div>
        <div class="stats-card p-4">
          <i class="fas fa-users text-2xl text-green-400 mb-2"></i>
          <h4 class="text-sm font-semibold text-text-secondary">TOTAL USERS</h4>
          <p id="total-users" class="text-lg font-bold text-accent-green">0</p>
        </div>
        <div class="stats-card p-4">
          <i class="fas fa-newspaper text-2xl text-yellow-400 mb-2"></i>
          <h4 class="text-sm font-semibold text-text-secondary">TOTAL NEWS POSTS</h4>
          <p id="total-news" class="text-lg font-bold text-accent-purple">0</p>
        </div>
        <div class="stats-card p-4">
          <i class="fas fa-box-open text-2xl text-red-400 mb-2"></i>
          <h4 class="text-sm font-semibold text-text-secondary">ADMIN PRODUCTS</h4>
          <p id="total-admin-products" class="text-lg font-bold text-accent-red">0</p>
        </div>
        <div class="stats-card p-4">
          <i class="fas fa-store text-2xl text-purple-400 mb-2"></i>
          <h4 class="text-sm font-semibold text-text-secondary">USER PRODUCTS</h4>
          <p id="total-user-products" class="text-lg font-bold text-accent-purple">0</p>
        </div>
        <div class="stats-card p-4">
          <i class="fas fa-receipt text-2xl text-orange-400 mb-2"></i>
          <h4 class="text-sm font-semibold text-text-secondary">TOTAL ORDERS</h4>
          <p id="total-orders" class="text-lg font-bold text-accent-green">0</p>
        </div>
      </div>
    </div>
  </div>

   Keys Section 
  <div id="keys-section" class="admin-section hidden">
    <div class="app-card p-4 md:p-8">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-key mr-3"></i>
        MANAGE KEYS
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">NEW KEY TEXT</label>
          <input type="text" id="new-key-text" placeholder="Unique Key" class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">EXPIRES AT</label>
          <input type="date" id="new-key-expires" class="app-input w-full">
        </div>
        <div class="md:col-span-2">
          <button onclick="addKey()" class="myanmar-btn w-full flex items-center justify-center space-x-2">
            <i class="fas fa-plus-circle"></i>
            <span>ADD NEW KEY</span>
          </button>
        </div>
      </div>

      <h4 class="text-md font-orbitron font-bold mb-4 mt-8 text-accent-green flex items-center">
        <i class="fas fa-list-alt mr-2"></i>
        EXISTING KEYS
      </h4>
      <div class="relative search-input-container mb-4">
        <input type="text" id="search-keys" placeholder="Search Keys..." class="app-input w-full" onkeyup="filterTable('keys-table-body', this.value)">
        <i class="fas fa-search search-icon"></i>
      </div>
      <div class="overflow-x-auto">
        <table class="app-table w-full">
          <thead>
            <tr>
              <th class="text-left">KEY</th>
              <th class="text-left">EXPIRES</th>
              <th class="text-left">STATUS</th>
              <th class="text-left">ACTIONS</th>
            </tr>
          </thead>
          <tbody id="keys-table-body">
            <tr>
              <td colspan="4" class="text-center text-text-secondary py-8">
                <div class="loading-spinner mx-auto mb-2"></div>
                Loading keys...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

   Users Section 
  <div id="users-section" class="admin-section hidden">
    <div class="app-card p-4 md:p-8">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-users mr-3"></i>
        MANAGE USERS
      </h3>
      <h4 class="text-md font-orbitron font-bold mb-4 text-accent-green flex items-center">
        <i class="fas fa-list-alt mr-2"></i>
        REGISTERED USERS
      </h4>
      <div class="relative search-input-container mb-4">
        <input type="text" id="search-users" placeholder="Search Users..." class="app-input w-full" onkeyup="filterTable('users-table-body', this.value)">
        <i class="fas fa-search search-icon"></i>
      </div>
      <div class="overflow-x-auto">
        <table class="app-table w-full">
          <thead>
            <tr>
              <th class="text-left">PROFILE</th>
              <th class="text-left">USERNAME</th>
              <th class="text-left">KEY ID</th>
              <th class="text-left">STATUS</th>
              <th class="text-left">ACTIONS</th>
            </tr>
          </thead>
          <tbody id="users-table-body">
            <tr>
              <td colspan="5" class="text-center text-text-secondary py-8">
                <div class="loading-spinner mx-auto mb-2"></div>
                Loading users...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

   News Section 
  <div id="news-section" class="admin-section hidden">
    <div class="app-card p-4 md:p-8">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-newspaper mr-3"></i>
        MANAGE NEWS
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">NEWS TITLE</label>
          <input type="text" id="news-title" placeholder="News Title" class="app-input w-full">
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2 text-text-secondary">NEWS CONTENT</label>
          <textarea id="news-content" placeholder="News Content..." rows="4" class="app-input w-full resize-none"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">MEDIA (IMAGE/VIDEO) OPTIONAL</label>
          <input type="file" id="news-media" accept="image/*,video/*" multiple class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">YOUTUBE LINK (OPTIONAL)</label>
          <input type="url" id="news-youtube" placeholder="https://youtube.com/..." class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">TIKTOK LINK (OPTIONAL)</label>
          <input type="url" id="news-tiktok" placeholder="https://tiktok.com/@..." class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">TELEGRAM LINK (OPTIONAL)</label>
          <input type="url" id="news-telegram" placeholder="https://t.me/..." class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">FACEBOOK LINK (OPTIONAL)</label>
          <input type="url" id="news-facebook" placeholder="https://facebook.com/..." class="app-input w-full">
        </div>
        <div class="flex items-end">
          <button onclick="postNews()" id="post-news-btn" class="myanmar-btn w-full flex items-center justify-center space-x-2">
            <i class="fas fa-paper-plane"></i>
            <span>POST NEWS</span>
          </button>
        </div>
      </div>

      <h4 class="text-md font-orbitron font-bold mb-4 mt-8 text-accent-green flex items-center">
        <i class="fas fa-list-alt mr-2"></i>
        ADMIN NEWS LIST
      </h4>
      <div class="relative search-input-container mb-4">
        <input type="text" id="search-admin-news" placeholder="Search Admin News..." class="app-input w-full" onkeyup="filterTable('admin-news-table-body', this.value)">
        <i class="fas fa-search search-icon"></i>
      </div>
      <div class="overflow-x-auto">
        <table class="app-table w-full">
          <thead>
            <tr>
              <th class="text-left">TITLE</th>
              <th class="text-left">VIEWS</th>
              <th class="text-left">LIKES</th>
              <th class="text-left">STATUS</th>
              <th class="text-left">ACTIONS</th>
            </tr>
          </thead>
          <tbody id="admin-news-table-body">
            <tr>
              <td colspan="5" class="text-center text-text-secondary py-8">
                <div class="loading-spinner mx-auto mb-2"></div>
                Loading admin news...
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <h4 class="text-md font-orbitron font-bold mb-4 mt-8 text-accent-green flex items-center">
        <i class="fas fa-list-alt mr-2"></i>
        USER NEWS LIST
      </h4>
      <div class="relative search-input-container mb-4">
        <input type="text" id="search-user-news" placeholder="Search User News..." class="app-input w-full" onkeyup="filterTable('user-news-table-body', this.value)">
        <i class="fas fa-search search-icon"></i>
      </div>
      <div class="overflow-x-auto">
        <table class="app-table w-full">
          <thead>
            <tr>
              <th class="text-left">TITLE</th>
              <th class="text-left">AUTHOR</th>
              <th class="text-left">VIEWS</th>
              <th class="text-left">LIKES</th>
              <th class="text-left">STATUS</th>
              <th class="text-left">ACTIONS</th>
            </tr>
          </thead>
          <tbody id="user-news-table-body">
            <tr>
              <td colspan="6" class="text-center text-text-secondary py-8">
                <div class="loading-spinner mx-auto mb-2"></div>
                Loading user news...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

   Products Section (Admin Products) 
  <div id="products-section" class="admin-section hidden">
    <div class="app-card p-4 md:p-8">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-box-open mr-3"></i>
        MANAGE ADMIN PRODUCTS & APKS
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">PRODUCT NAME</label>
          <input type="text" id="product-name" placeholder="Product Name" class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">PRICE (MMK)</label>
          <input type="number" id="product-price" placeholder="0.00" min="0" step="0.01" class="app-input w-full">
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2 text-text-secondary">DESCRIPTION</label>
          <textarea id="product-description" placeholder="Product Description..." rows="3" class="app-input w-full resize-none"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">APK ICON (IMAGE)</label>
          <input type="file" id="product-apk-icon" accept="image/*" class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">APK FILE</label>
          <input type="file" id="product-apk-file" accept=".apk" class="app-input w-full">
        </div>
        <div class="md:col-span-2">
          <button onclick="uploadProduct()" class="myanmar-btn w-full flex items-center justify-center space-x-2">
            <i class="fas fa-upload"></i>
            <span>UPLOAD PRODUCT</span>
          </button>
        </div>
      </div>

      <h4 class="text-md font-orbitron font-bold mb-4 mt-8 text-accent-green flex items-center">
        <i class="fas fa-list-alt mr-2"></i>
        EXISTING ADMIN PRODUCTS
      </h4>
      <div class="relative search-input-container mb-4">
        <input type="text" id="search-products" placeholder="Search Products..." class="app-input w-full" onkeyup="filterTable('products-table-body', this.value)">
        <i class="fas fa-search search-icon"></i>
      </div>
      <div class="overflow-x-auto">
        <table class="app-table w-full">
          <thead>
            <tr>
              <th class="text-left">ICON</th>
              <th class="text-left">NAME</th>
              <th class="text-left">PRICE</th>
              <th class="text-left">STATUS</th>
              <th class="text-left">ACTIONS</th>
            </tr>
          </thead>
          <tbody id="products-table-body">
            <tr>
              <td colspan="5" class="text-center text-text-secondary py-8">
                <div class="loading-spinner mx-auto mb-2"></div>
                Loading products...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

   User Products Section 
  <div id="user-products-section" class="admin-section hidden">
    <div class="app-card p-4 md:p-8">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-store mr-3"></i>
        MANAGE USER PRODUCTS
      </h3>
      <h4 class="text-md font-orbitron font-bold mb-4 text-accent-green flex items-center">
        <i class="fas fa-list-alt mr-2"></i>
        ALL USER LISTED PRODUCTS
      </h4>
      <div class="relative search-input-container mb-4">
        <input type="text" id="search-all-user-products" placeholder="Search User Products..." class="app-input w-full" onkeyup="filterTable('all-user-products-table-body', this.value)">
        <i class="fas fa-search search-icon"></i>
      </div>
      <div class="overflow-x-auto">
        <table class="app-table w-full">
          <thead>
            <tr>
              <th class="text-left">IMAGE</th>
              <th class="text-left">NAME</th>
              <th class="text-left">SELLER</th>
              <th class="text-left">PRICE</th>
              <th class="text-left">STATUS</th>
              <th class="text-left">ACTIONS</th>
            </tr>
          </thead>
          <tbody id="all-user-products-table-body">
            <tr>
              <td colspan="6" class="text-center text-text-secondary py-8">
                <div class="loading-spinner mx-auto mb-2"></div>
                Loading user products...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

   Orders Section 
  <div id="orders-section" class="admin-section hidden">
    <div class="app-card p-4 md:p-8">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-receipt mr-3"></i>
        MANAGE ORDERS
      </h3>
      <h4 class="text-md font-orbitron font-bold mb-4 text-accent-green flex items-center">
        <i class="fas fa-list-alt mr-2"></i>
        ADMIN PRODUCT ORDERS
      </h4>
      <div class="relative search-input-container mb-4">
        <input type="text" id="search-admin-orders" placeholder="Search Admin Product Orders..." class="app-input w-full" onkeyup="filterTable('admin-orders-table-body', this.value)">
        <i class="fas fa-search search-icon"></i>
      </div>
      <div class="overflow-x-auto">
        <table class="app-table w-full">
          <thead>
            <tr>
              <th class="text-left">ORDER ID</th>
              <th class="text-left">BUYER</th>
              <th class="text-left">PRODUCT</th>
              <th class="text-left">AMOUNT</th>
              <th class="text-left">RECEIPT</th>
              <th class="text-left">STATUS</th>
              <th class="text-left">ACTIONS</th>
            </tr>
          </thead>
          <tbody id="admin-orders-table-body">
            <tr>
              <td colspan="7" class="text-center text-text-secondary py-8">
                <div class="loading-spinner mx-auto mb-2"></div>
                Loading admin product orders...
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <h4 class="text-md font-orbitron font-bold mb-4 mt-8 text-accent-green flex items-center">
        <i class="fas fa-list-alt mr-2"></i>
        USER PRODUCT ORDERS
      </h4>
      <div class="relative search-input-container mb-4">
        <input type="text" id="search-user-orders" placeholder="Search User Product Orders..." class="app-input w-full" onkeyup="filterTable('user-orders-table-body', this.value)">
        <i class="fas fa-search search-icon"></i>
      </div>
      <div class="overflow-x-auto">
        <table class="app-table w-full">
          <thead>
            <tr>
              <th class="text-left">ORDER ID</th>
              <th class="text-left">BUYER</th>
              <th class="text-left">SELLER</th>
              <th class="text-left">PRODUCT</th>
              <th class="text-left">AMOUNT</th>
              <th class="text-left">RECEIPT</th>
              <th class="text-left">STATUS</th>
              <th class="text-left">ACTIONS</th>
            </tr>
          </thead>
          <tbody id="user-orders-table-body">
            <tr>
              <td colspan="8" class="text-center text-text-secondary py-8">
                <div class="loading-spinner mx-auto mb-2"></div>
                Loading user product orders...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

   Payment Methods Section 
  <div id="payment-methods-section" class="admin-section hidden">
    <div class="app-card p-4 md:p-8">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-wallet mr-3"></i>
        MANAGE PAYMENT METHODS
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">METHOD NAME</label>
          <input type="text" id="payment-method-name" placeholder="KBZ Pay / Wave Money" class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">ACCOUNT INFO</label>
          <input type="text" id="payment-account-info" placeholder="Phone Number / Account Number" class="app-input w-full">
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2 text-text-secondary">INSTRUCTIONS</label>
          <textarea id="payment-instructions" placeholder="Instructions for transfer..." rows="2" class="app-input w-full resize-none"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">QR CODE IMAGE (OPTIONAL)</label>
          <input type="file" id="payment-qr-code" accept="image/*" class="app-input w-full">
        </div>
        <div class="flex items-end">
          <button onclick="addPaymentMethod()" class="myanmar-btn w-full flex items-center justify-center space-x-2">
            <i class="fas fa-plus"></i>
            <span>ADD NEW METHOD</span>
          </button>
        </div>
      </div>

      <h4 class="text-md font-orbitron font-bold mb-4 mt-8 text-accent-green flex items-center">
        <i class="fas fa-list-alt mr-2"></i>
        EXISTING PAYMENT METHODS
      </h4>
      <div class="relative search-input-container mb-4">
        <input type="text" id="search-payment-methods" placeholder="Search Payment Methods..." class="app-input w-full" onkeyup="filterTable('payment-methods-table-body', this.value)">
        <i class="fas fa-search search-icon"></i>
      </div>
      <div class="overflow-x-auto">
        <table class="app-table w-full">
          <thead>
            <tr>
              <th class="text-left">METHOD</th>
              <th class="text-left">ACCOUNT INFO</th>
              <th class="text-left">QR CODE</th>
              <th class="text-left">STATUS</th>
              <th class="text-left">ACTIONS</th>
            </tr>
          </thead>
          <tbody id="payment-methods-table-body">
            <tr>
              <td colspan="5" class="text-center text-text-secondary py-8">
                <div class="loading-spinner mx-auto mb-2"></div>
                Loading payment methods...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

   Chat Section 
  <div id="chat-section" class="admin-section hidden">
    <div class="app-card p-4 md:p-8">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-comments mr-3"></i>
        GLOBAL CHAT
      </h3>
      <div id="chat-messages" class="bg-black bg-opacity-30 rounded-xl p-4 h-64 md:h-96 overflow-y-auto mb-6 border border-gray-700">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-center text-text-secondary">Loading messages...</p>
      </div>
      <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4">
        <textarea id="chat-input" placeholder="Type your message..." rows="3"
                  class="app-input flex-1 resize-none"></textarea>
        <button onclick="sendChatMessage()" 
                class="myanmar-btn flex items-center justify-center space-x-2 md:self-end">
          <i class="fas fa-paper-plane"></i>
          <span>SEND</span>
        </button>
      </div>
    </div>
  </div>

   Support Section 
  <div id="support-section" class="admin-section hidden">
    <div class="app-card p-4 md:p-8">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-headset mr-3"></i>
        MANAGE SUPPORT MESSAGES
      </h3>
      <h4 class="text-md font-orbitron font-bold mb-4 text-accent-green flex items-center">
        <i class="fas fa-list-alt mr-2"></i>
        ALL SUPPORT TICKETS
      </h4>
      <div class="relative search-input-container mb-4">
        <input type="text" id="search-support" placeholder="Search Support Messages..." class="app-input w-full" onkeyup="filterTable('support-table-body', this.value)">
        <i class="fas fa-search search-icon"></i>
      </div>
      <div class="overflow-x-auto">
        <table class="app-table w-full">
          <thead>
            <tr>
              <th class="text-left">SENDER</th>
              <th class="text-left">MESSAGE</th>
              <th class="text-left">PRIORITY</th>
              <th class="text-left">STATUS</th>
              <th class="text-left">ACTIONS</th>
            </tr>
          </thead>
          <tbody id="support-table-body">
            <tr>
              <td colspan="5" class="text-center text-text-secondary py-8">
                <div class="loading-spinner mx-auto mb-2"></div>
                Loading support messages...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

   About Section 
  <div id="about-section" class="admin-section hidden">
    <div class="app-card p-4 md:p-8">
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-info-circle mr-3"></i>
        MANAGE ABOUT US
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">CONTACT NAME</label>
          <input type="text" id="about-contact-name" placeholder="Contact Name" class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">PHONE</label>
          <input type="text" id="about-phone" placeholder="Phone Number" class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">EMAIL</label>
          <input type="email" id="about-email" placeholder="Email Address" class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">TELEGRAM LINK</label>
          <input type="url" id="about-telegram" placeholder="https://t.me/..." class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">VIBER LINK</label>
          <input type="url" id="about-viber" placeholder="viber://chat?number=..." class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">FACEBOOK LINK</label>
          <input type="url" id="about-facebook" placeholder="https://facebook.com/..." class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">TIKTOK LINK</label>
          <input type="url" id="about-tiktok" placeholder="https://tiktok.com/@..." class="app-input w-full">
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2 text-text-secondary">SOCIAL LINKS (JSON Array - optional)</label>
          <textarea id="about-social-links" rows="3" placeholder='[{"name": "Website", "url": "...", "icon_url": "..."}]' class="app-input w-full resize-none font-share-tech"></textarea>
          <p class="text-xs text-text-secondary mt-1">
            Example: `[{"name": "Website", "url": "https://www.example.com", "icon_url": "/placeholder.svg?height=24&width=24"}]`
          </p>
        </div>
        <div class="md:col-span-2">
          <button onclick="updateAbout()" class="myanmar-btn w-full flex items-center justify-center space-x-2">
            <i class="fas fa-save"></i>
            <span>UPDATE ABOUT INFO</span>
          </button>
        </div>
      </div>
    </div>
  </div>

</div>
</div>

 News Detail Modal (for Admin News) 
<div id="news-modal" class="modal hidden">
<div class="modal-content max-w-2xl">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-orbitron font-bold text-accent-purple">NEWS DETAILS</h2>
    <button onclick="closeNewsModal()" class="text-text-secondary hover:text-accent-red">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div id="news-modal-content">
    <div class="loading-spinner mx-auto mb-4"></div>
    <p class="text-center text-text-secondary">Loading...</p>
  </div>
</div>
</div>

 News Detail Modal (for Profile News) 
<div id="profile-news-modal" class="modal hidden">
  <div class="modal-content max-w-2xl">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-orbitron font-bold text-accent-purple">PROFILE NEWS DETAILS</h2>
      <button onclick="closeProfileNewsModal()" class="text-text-secondary hover:text-accent-red">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="profile-news-modal-content">
      <div class="loading-spinner mx-auto mb-4"></div>
      <p class="text-center text-text-secondary">Loading...</p>
    </div>
  </div>
</div>

 Product Detail Modal (for Admin Products) 
<div id="product-modal" class="modal hidden">
<div class="modal-content max-w-2xl">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-orbitron font-bold text-accent-purple">PRODUCT DETAILS</h2>
    <button onclick="closeProductModal()" class="text-text-secondary hover:text-accent-red">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div id="product-modal-content">
    <div class="loading-spinner mx-auto mb-4"></div>
    <p class="text-center text-text-secondary">Loading...</p>
  </div>
</div>
</div>

 User Product Detail Modal 
<div id="user-product-modal" class="modal hidden">
  <div class="modal-content max-w-2xl">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-orbitron font-bold text-accent-purple">USER PRODUCT DETAILS</h2>
      <button onclick="closeUserProductModal()" class="text-text-secondary hover:text-accent-red">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="user-product-modal-content">
      <div class="loading-spinner mx-auto mb-4"></div>
      <p class="text-center text-text-secondary">Loading...</p>
    </div>
  </div>
</div>

 Order Slip Modal 
<div id="order-slip-modal" class="modal hidden">
  <div class="slip-modal-content">
    <button onclick="closeOrderSlipModal()" class="modal-close-button absolute top-4 right-4 text-gray-600 hover:text-gray-900 print:hidden">
      <i class="fas fa-times text-2xl"></i>
    </button>
    <div id="order-slip-content">
       Slip content will be dynamically loaded here 
    </div>
    <div class="slip-actions flex justify-center gap-4 mt-6 print:hidden">
      <button onclick="printOrderSlip()" class="myanmar-btn btn-small">
        <i class="fas fa-print mr-2"></i> PRINT
      </button>
      <button onclick="downloadOrderSlip()" class="myanmar-btn btn-small">
        <i class="fas fa-download mr-2"></i> DOWNLOAD PDF
      </button>
    </div>
  </div>
</div>

 Confirm Delete Modal 
<div id="confirm-modal" class="modal hidden">
<div class="modal-content max-w-md">
  <div class="text-center">
    <i class="fas fa-exclamation-triangle text-4xl text-accent-red mb-4"></i>
    <h3 class="text-xl font-orbitron font-bold text-text-primary mb-4">ARE YOU SURE?</h3>
    <p id="confirm-message" class="text-text-secondary mb-6">This action cannot be undone.</p>
    <div class="flex space-x-4">
      <button onclick="closeConfirmModal()" class="myanmar-btn flex-1">
        <i class="fas fa-times mr-2"></i>
        CANCEL
      </button>
      <button onclick="confirmAction()" class="btn-danger myanmar-btn flex-1">
        <i class="fas fa-trash mr-2"></i>
        DELETE
      </button>
    </div>
  </div>
</div>
</div>

 Loading Overlay 
<div id="loading-overlay" class="fixed inset-0 loading-overlay flex items-center justify-center z-50 hidden">
<div class="app-card p-8 text-center">
  <div class="loading-spinner mx-auto mb-4" style="width: 40px; height: 40px;"></div>
  <p class="text-text-primary font-semibold">PROCESSING...</p>
</div>
</div>

 Scripts 
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
// Configuration
const CONFIG = {
  SUPABASE_URL: 'https://rmeudvhvqlddqqkiziyo.supabase.co',
  SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJtZXVkdmh2cWxkZHFxa2l6aXlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5OTMxOTIsImV4cCI6MjA2OTU2OTE5Mn0.xFgMv-K5o5yyTpe4U2YJK5jC9GPJp98G4cgD9p5W4ak',
  ADMIN_USERNAME: 'admin', // Replace with your actual admin username
  ADMIN_PASSWORD: 'admin_password', // Replace with your actual admin password
  MAX_RETRY_ATTEMPTS: 3,
  RETRY_DELAY: 2000
};

// State
let state = {
  supabase: null,
  isAuthenticated: false,
  currentSection: 'dashboard',
  reconnectAttempts: 0,
  isConnected: false,
  confirmCallback: null,
  adminProfile: null, // Stores current admin's profile data
  keysRealtime: null,
  profilesRealtime: null,
  newsRealtime: null,
  profileNewsRealtime: null,
  productsRealtime: null,
  userProductsRealtime: null,
  ordersRealtime: null,
  userOrdersRealtime: null,
  paymentMethodsRealtime: null,
  chatRealtime: null,
  supportRealtime: null,
  allUsers: [], // Cache for filtering
  allKeys: [], // Cache for filtering
  allAdminNews: [], // Cache for filtering
  allUserNews: [], // Cache for filtering
  allProducts: [], // Cache for filtering
  allUserProducts: [], // Cache for filtering
  allAdminOrders: [], // Cache for filtering
  allUserOrders: [], // Cache for filtering
  allPaymentMethods: [], // Cache for filtering
  allSupportMessages: [], // Cache for filtering
};

// Utility Functions
const utils = {
  formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  },
  getMediaType(fileType) {
    if (fileType.startsWith('image/')) return 'image';
    if (fileType.startsWith('video/')) return 'video';
    if (fileType.startsWith('audio/')) return 'audio';
    return 'file';
  },
  formatPrice(price) {
    return `${parseFloat(price).toFixed(2)} MMK`;
  }
};

// Initialize
document.addEventListener('DOMContentLoaded', initializeApp);

async function initializeApp() {
  updateConnectionStatus('connecting');
  
  try {
    // Check if Supabase config is set
    if (!CONFIG.SUPABASE_URL || CONFIG.SUPABASE_URL === 'YOUR_SUPABASE_URL_HERE') {
      throw new Error('Supabase URL လိုအပ်ပါတယ်! CONFIG အပိုင်းထဲမှာ သင့် Supabase URL ကို ထည့်ပါ။');
    }

    if (!CONFIG.SUPABASE_ANON_KEY || CONFIG.SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY_HERE') {
      throw new Error('Supabase Anon Key လိုအပ်ပါတယ်! CONFIG အပိုင်းထဲမှာ သင့် Supabase Anon Key ကို ထည့်ပါ။');
    }

    // Initialize Supabase
    if (typeof supabase !== 'undefined') {
      state.supabase = supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY, {
        auth: { persistSession: false },
        realtime: { params: { eventsPerSecond: 10 } }
      });

      // Test connection
      const { data, error } = await state.supabase.from('about').select('id').limit(1);
      
      if (error && error.code !== 'PGRST116') { // PGRST116 means table not found, which is fine for initial setup
        throw new Error(`Database connection failed: ${error.message}`);
      }

      updateConnectionStatus('online');
      showNotification('Database connected successfully! Admin Dashboard အသုံးပြုရန် အသင့်ဖြစ်ပါတယ်။', 'success');
      
      state.isConnected = true;
      state.reconnectAttempts = 0;

      // Check for existing admin session (if any, e.g., from previous login)
      // For this simple example, we'll rely on direct login.
      
    } else {
      throw new Error('Supabase library မတင်လို့ရပါ');
    }
  } catch (error) {
    console.error('Initialization error:', error);
    updateConnectionStatus('offline');
    showNotification(`Connection failed: ${error.message}`, 'error');
    
    // Retry connection
    if (state.reconnectAttempts < CONFIG.MAX_RETRY_ATTEMPTS) {
      state.reconnectAttempts++;
      setTimeout(() => {
        console.log(`Retrying connection (${state.reconnectAttempts}/${CONFIG.MAX_RETRY_ATTEMPTS})...`);
        initializeApp();
      }, CONFIG.RETRY_DELAY);
    }
  }

  // Add enter key listener for admin password input
  document.getElementById('admin-password').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      adminLogin();
    }
  });
}

function updateConnectionStatus(status) {
  const statusElement = document.getElementById('connection-status');
  statusElement.className = 'connection-status';
  
  switch (status) {
    case 'online':
      statusElement.classList.add('status-online');
      statusElement.innerHTML = '<i class="fas fa-check-circle"></i> ONLINE';
      break;
    case 'offline':
      statusElement.classList.add('status-offline');
      statusElement.innerHTML = '<i class="fas fa-exclamation-triangle"></i> OFFLINE';
      break;
    case 'connecting':
      statusElement.classList.add('status-connecting');
      statusElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ချိတ်ဆက်နေသည်...';
      break;
  }
}

function showNotification(message, type = 'info', duration = 5000) {
  const container = document.getElementById('notification-container');
  const notification = document.createElement('div');
  
  const bgColors = {
    success: 'bg-green-600',
    error: 'bg-red-600',
    info: 'bg-blue-600',
    warning: 'bg-yellow-600'
  };
  
  const icons = {
    success: 'fa-check-circle',
    error: 'fa-exclamation-triangle',
    info: 'fa-info-circle',
    warning: 'fa-exclamation-circle'
  };
  
  notification.className = `notification ${bgColors[type]}`;
  notification.innerHTML = `
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <i class="fas ${icons[type]} mr-2"></i>
        <span>${message}</span>
      </div>
      <button onclick="this.parentElement.parentElement.remove()" class="ml-4 hover:text-gray-200">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `;
  
  container.appendChild(notification);
  
  setTimeout(() => {
    if (notification.parentElement) {
      notification.remove();
    }
  }, duration);
}

async function adminLogin() {
  if (!state.isConnected) {
    showNotification('Waiting for database connection...', 'warning');
    return;
  }

  const username = document.getElementById('admin-username').value.trim();
  const password = document.getElementById('admin-password').value.trim();
  const loginBtn = document.getElementById('admin-login-btn');
  const loginText = document.getElementById('admin-login-text');

  if (!username || !password) {
    showNotification('Please enter username and password', 'warning');
    return;
  }

  if (username !== CONFIG.ADMIN_USERNAME || password !== CONFIG.ADMIN_PASSWORD) {
    showNotification('Invalid Admin Credentials', 'error');
    return;
  }

  try {
    loginBtn.disabled = true;
    loginText.textContent = 'LOGGING IN...';
    showLoading(true);

    // For admin, we'll fetch the admin_profile based on a known ID (from SQL seed)
    // In a real app, you'd use Supabase Auth with email/password or a custom JWT.
    // For this example, we'll assume a fixed admin ID for RLS.
    const adminId = 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11'; // This ID must match the one in supabase_schema.sql
    const { data: adminProfile, error } = await state.supabase
      .from('admin_profiles')
      .select('*')
      .eq('id', adminId)
      .single();

    if (error || !adminProfile) {
      throw new Error('Admin profile not found or database error.');
    }

    state.adminProfile = adminProfile;
    state.isAuthenticated = true;

    // Simulate Supabase session for RLS to work with auth.uid()
    const dummyJwt = "oF45hT1e2dwi9n4T607bK7/t1IB+Q7BUgADv3YEC6cpUtsaw56JURTDVudlBtCevdkvZMuCNDouKhC3WeZVfhQ==" + adminId + "\",\"role\":\"authenticated\"}";
    state.supabase.auth.setSession({
        access_token: dummyJwt,
        refresh_token: dummyJwt,
        expires_in: 3600,
        token_type: 'bearer',
        user: {
            id: adminId, // Set auth.uid() to adminId
            aud: 'authenticated',
            role: 'authenticated',
            email: null,
            phone: null,
            created_at: new Date().toISOString(),
            updated_at: new Date().toISOString(),
            user_metadata: {},
            app_metadata: {
                provider: 'custom',
                providers: ['custom']
            }
        }
    });

    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('admin-content').classList.remove('hidden');
    showNotification('Admin login successful!', 'success');
    
    await loadDashboardData();
    setupRealtimeSubscriptions();
    showSection('dashboard', document.querySelector('.nav-btn.active'));

  } catch (error) {
    console.error('Admin login error:', error);
    showNotification('Login failed: ' + error.message, 'error');
    adminLogout(); // Ensure logout on error
  } finally {
    loginBtn.disabled = false;
    loginText.textContent = 'LOGIN';
    showLoading(false);
  }
}

function adminLogout() {
  state.isAuthenticated = false;
  state.adminProfile = null;
  state.supabase.auth.signOut(); // Clear Supabase session
  // Unsubscribe from all channels
  if (state.keysRealtime) state.supabase.removeChannel(state.keysRealtime);
  if (state.profilesRealtime) state.supabase.removeChannel(state.profilesRealtime);
  if (state.newsRealtime) state.supabase.removeChannel(state.newsRealtime);
  if (state.profileNewsRealtime) state.supabase.removeChannel(state.profileNewsRealtime);
  if (state.productsRealtime) state.supabase.removeChannel(state.productsRealtime);
  if (state.userProductsRealtime) state.supabase.removeChannel(state.userProductsRealtime);
  if (state.ordersRealtime) state.supabase.removeChannel(state.ordersRealtime);
  if (state.userOrdersRealtime) state.supabase.removeChannel(state.userOrdersRealtime);
  if (state.paymentMethodsRealtime) state.supabase.removeChannel(state.paymentMethodsRealtime);
  if (state.chatRealtime) state.supabase.removeChannel(state.chatRealtime);
  if (state.supportRealtime) state.supabase.removeChannel(state.supportRealtime);

  document.getElementById('admin-content').classList.add('hidden');
  document.getElementById('login-section').classList.remove('hidden');
  document.getElementById('admin-username').value = '';
  document.getElementById('admin-password').value = '';
  showNotification('Logged out successfully.', 'info');
}

async function loadDashboardData() {
  try {
    const [keysResult, usersResult, newsResult, profileNewsResult, productsResult, userProductsResult, ordersResult, userOrdersResult] = await Promise.all([
      state.supabase.from('keys').select('id', { count: 'exact' }),
      state.supabase.from('profiles').select('id', { count: 'exact' }),
      state.supabase.from('news').select('id', { count: 'exact' }),
      state.supabase.from('profile_news').select('id', { count: 'exact' }),
      state.supabase.from('products').select('id', { count: 'exact' }),
      state.supabase.from('user_products').select('id', { count: 'exact' }),
      state.supabase.from('orders').select('id', { count: 'exact' }),
      state.supabase.from('user_orders').select('id', { count: 'exact' })
    ]);

    document.getElementById('total-keys').textContent = keysResult.count || 0;
    document.getElementById('total-users').textContent = usersResult.count || 0;
    document.getElementById('total-news').textContent = (newsResult.count || 0) + (profileNewsResult.count || 0);
    document.getElementById('total-admin-products').textContent = productsResult.count || 0;
    document.getElementById('total-user-products').textContent = userProductsResult.count || 0;
    document.getElementById('total-orders').textContent = (ordersResult.count || 0) + (userOrdersResult.count || 0);

  } catch (error) {
    console.error('Error loading dashboard data:', error);
    showNotification('Failed to retrieve dashboard data', 'error');
  }
}

function setupRealtimeSubscriptions() {
  // Unsubscribe from previous channels if they exist
  if (state.keysRealtime) state.supabase.removeChannel(state.keysRealtime);
  if (state.profilesRealtime) state.supabase.removeChannel(state.profilesRealtime);
  if (state.newsRealtime) state.supabase.removeChannel(state.newsRealtime);
  if (state.profileNewsRealtime) state.supabase.removeChannel(state.profileNewsRealtime);
  if (state.productsRealtime) state.supabase.removeChannel(state.productsRealtime);
  if (state.userProductsRealtime) state.supabase.removeChannel(state.userProductsRealtime);
  if (state.ordersRealtime) state.supabase.removeChannel(state.ordersRealtime);
  if (state.userOrdersRealtime) state.supabase.removeChannel(state.userOrdersRealtime);
  if (state.paymentMethodsRealtime) state.supabase.removeChannel(state.paymentMethodsRealtime);
  if (state.chatRealtime) state.supabase.removeChannel(state.chatRealtime);
  if (state.supportRealtime) state.supabase.removeChannel(state.supportRealtime);

  // Keys realtime updates
  state.keysRealtime = state.supabase
    .channel('keys_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'keys' }, (payload) => {
      if (state.currentSection === 'keys') loadKeysData();
      loadDashboardData();
    })
    .subscribe();

  // Profiles realtime updates
  state.profilesRealtime = state.supabase
    .channel('profiles_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'profiles' }, (payload) => {
      if (state.currentSection === 'users') loadUsersData();
      loadDashboardData();
    })
    .subscribe();

  // News realtime updates (Admin News)
  state.newsRealtime = state.supabase
    .channel('news_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'news' }, (payload) => {
      if (state.currentSection === 'news') loadNewsData();
      loadDashboardData();
    })
    .subscribe();

  // Profile News realtime updates (User Posted News)
  state.profileNewsRealtime = state.supabase
    .channel('profile_news_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'profile_news' }, (payload) => {
      if (state.currentSection === 'news') loadNewsData();
      loadDashboardData();
    })
    .subscribe();

  // Products realtime updates (Admin Products)
  state.productsRealtime = state.supabase
    .channel('products_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'products' }, (payload) => {
      if (state.currentSection === 'products') loadProductsData();
      loadDashboardData();
    })
    .subscribe();

  // User Products realtime updates
  state.userProductsRealtime = state.supabase
    .channel('user_products_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'user_products' }, (payload) => {
      if (state.currentSection === 'user-products') loadUserProductsData();
      loadDashboardData();
    })
    .subscribe();

  // Orders realtime updates (Admin Product Orders)
  state.ordersRealtime = state.supabase
    .channel('orders_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'orders' }, (payload) => {
      if (state.currentSection === 'orders') loadAdminOrdersData();
      loadDashboardData();
    })
    .subscribe();

  // User Orders realtime updates
  state.userOrdersRealtime = state.supabase
    .channel('user_orders_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'user_orders' }, (payload) => {
      if (state.currentSection === 'orders') loadUserOrdersData();
      loadDashboardData();
    })
    .subscribe();

  // Payment Methods realtime updates
  state.paymentMethodsRealtime = state.supabase
    .channel('payment_methods_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'payment_methods' }, (payload) => {
      if (state.currentSection === 'payment-methods') loadPaymentMethodsData();
    })
    .subscribe();

  // Chat messages realtime (Global Chat)
  state.chatRealtime = state.supabase
    .channel('chat_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'chat_messages' }, (payload) => {
      if (state.currentSection === 'chat') loadChatMessages();
    })
    .subscribe();

  // Support messages realtime
  state.supportRealtime = state.supabase
    .channel('support_changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'support_messages' }, (payload) => {
      if (state.currentSection === 'support') loadSupportMessages();
    })
    .subscribe();
}

function showSection(section, buttonElement) {
  // Hide all sections
  document.querySelectorAll('.admin-section').forEach(sec => {
    sec.classList.add('hidden');
  });
  
  // Update navigation
  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  
  // Show selected section
  const sectionElement = document.getElementById(`${section}-section`);
  if (sectionElement) {
    sectionElement.classList.remove('hidden');
    sectionElement.classList.add('fade-in');
  }
  
  // Update active nav
  if (buttonElement) {
    buttonElement.classList.add('active');
  }
  state.currentSection = section;
  
  // Load section data
  switch (section) {
    case 'dashboard':
      loadDashboardData();
      break;
    case 'keys':
      loadKeysData();
      break;
    case 'users':
      loadUsersData();
      break;
    case 'news':
      loadNewsData(); // Loads both admin and user news
      break;
    case 'products':
      loadProductsData(); // Loads admin products
      break;
    case 'user-products':
      loadUserProductsData(); // Loads user products
      break;
    case 'orders':
      loadAdminOrdersData(); // Loads admin product orders
      loadUserOrdersData(); // Loads user product orders
      break;
    case 'payment-methods':
      loadPaymentMethodsData();
      break;
    case 'chat':
      loadChatMessages();
      break;
    case 'support':
      loadSupportMessages();
      break;
    case 'about':
      loadAboutData();
      break;
  }
}

async function addKey() {
  const keyText = document.getElementById('new-key-text').value.trim();
  const expiresAt = document.getElementById('new-key-expires').value;

  if (!keyText || !expiresAt) {
    showNotification('Please enter Key Text and Expiration Date', 'warning');
    return;
  }

  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('keys')
      .insert({ key_text: keyText, expires_at: expiresAt, is_active: true });

    if (error) throw error;

    document.getElementById('new-key-text').value = '';
    document.getElementById('new-key-expires').value = '';
    showNotification('Key added successfully!', 'success');
    loadKeysData();
  } catch (error) {
    console.error('Error adding key:', error);
    if (error.code === '23505') { // Unique constraint violation
      showNotification('Key already exists. Please use a unique key.', 'error');
    } else {
      showNotification('Failed to add key: ' + error.message, 'error');
    }
  } finally {
    showLoading(false);
  }
}

async function loadKeysData() {
  const keysTableBody = document.getElementById('keys-table-body');
  keysTableBody.innerHTML = `
    <tr>
      <td colspan="4" class="text-center text-text-secondary py-8">
        <div class="loading-spinner mx-auto mb-2"></div>
        Loading keys...
      </td>
    </tr>
  `;

  try {
    const { data: keys, error } = await state.supabase
      .from('keys')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) throw error;

    state.allKeys = keys || []; // Cache for filtering
    renderKeys(state.allKeys);

  } catch (error) {
    console.error('Error loading keys:', error);
    keysTableBody.innerHTML = `
      <tr>
        <td colspan="4" class="text-center text-accent-red py-8">
          <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
          <p>Failed to retrieve keys</p>
        </td>
      </tr>
    `;
  }
}

function renderKeys(keysToRender) {
  const keysTableBody = document.getElementById('keys-table-body');
  if (keysToRender && keysToRender.length > 0) {
    keysTableBody.innerHTML = keysToRender.map(key => {
      const statusClass = key.is_active ? 'status-active' : 'status-inactive';
      const statusText = key.is_active ? 'ACTIVE' : 'INACTIVE';
      const expiresDate = new Date(key.expires_at).toLocaleDateString('my-MM');
      
      return `
        <tr>
          <td class="font-share-tech">${key.key_text}</td>
          <td>${expiresDate}</td>
          <td class="${statusClass}">${statusText}</td>
          <td class="table-actions">
            <button onclick="toggleKeyStatus('${key.id}', ${key.is_active})" class="myanmar-btn btn-small">
              <i class="fas ${key.is_active ? 'fa-eye-slash' : 'fa-eye'}"></i>
            </button>
            <button onclick="deleteKey('${key.id}')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    keysTableBody.innerHTML = `
      <tr>
        <td colspan="4" class="text-center text-text-secondary py-8">
          <i class="fas fa-key text-4xl mb-4"></i>
          <p>No Keys Found</p>
        </td>
      </tr>
    `;
  }
}

async function toggleKeyStatus(keyId, currentStatus) {
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('keys')
      .update({ is_active: !currentStatus })
      .eq('id', keyId);

    if (error) throw error;

    showNotification(`Key status updated to ${!currentStatus ? 'Active' : 'Inactive'}`, 'success');
    loadKeysData();
  } catch (error) {
    console.error('Error toggling key status:', error);
    showNotification('Failed to update key status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function deleteKey(keyId) {
  showConfirmModal(
    'Are you sure you want to delete this key? This will also delete associated user profile.',
    async () => {
      showLoading(true);
      try {
        const { error } = await state.supabase
          .from('keys')
          .delete()
          .eq('id', keyId);

        if (error) throw error;

        showNotification('Key deleted successfully!', 'success');
        loadKeysData();
      } catch (error) {
        console.error('Error deleting key:', error);
        showNotification('Failed to delete key: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
  );
}

async function loadUsersData() {
  const usersTableBody = document.getElementById('users-table-body');
  usersTableBody.innerHTML = `
    <tr>
      <td colspan="5" class="text-center text-text-secondary py-8">
        <div class="loading-spinner mx-auto mb-2"></div>
        Loading users...
      </td>
    </tr>
  `;

  try {
    const { data: users, error } = await state.supabase
      .from('profiles')
      .select(`
        *,
        keys(key_text)
      `)
      .order('created_at', { ascending: false });

    if (error) throw error;

    state.allUsers = users || []; // Cache for filtering
    renderUsers(state.allUsers);

  } catch (error) {
    console.error('Error loading users:', error);
    usersTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-accent-red py-8">
          <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
          <p>Failed to retrieve users</p>
        </td>
      </tr>
    `;
  }
}

function renderUsers(usersToRender) {
  const usersTableBody = document.getElementById('users-table-body');
  if (usersToRender && usersToRender.length > 0) {
    usersTableBody.innerHTML = usersToRender.map(user => {
      const statusClass = user.is_banned ? 'status-banned' : 'status-active';
      const statusText = user.is_banned ? 'BANNED' : 'ACTIVE';
      const profilePicture = user.profile_picture || '/placeholder.svg?height=40&width=40';
      
      return `
        <tr>
          <td>
            <div class="flex items-center space-x-2">
              <img src="${profilePicture}" class="w-8 h-8 rounded-full object-cover" alt="Profile">
              <span>${user.name}</span>
            </div>
          </td>
          <td>@${user.username}</td>
          <td class="font-share-tech">${user.key_id}</td>
          <td class="${statusClass}">${statusText}</td>
          <td class="table-actions">
            <button onclick="toggleUserBanStatus('${user.id}', ${user.is_banned})" class="myanmar-btn btn-small">
              <i class="fas ${user.is_banned ? 'fa-unlock' : 'fa-ban'}"></i>
            </button>
            <button onclick="deleteUser('${user.id}')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    usersTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-text-secondary py-8">
          <i class="fas fa-users text-4xl mb-4"></i>
          <p>No Users Found</p>
        </td>
      </tr>
    `;
  }
}

async function toggleUserBanStatus(userId, currentStatus) {
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('profiles')
      .update({ is_banned: !currentStatus })
      .eq('id', userId);

    if (error) throw error;

    showNotification(`User status updated to ${!currentStatus ? 'Banned' : 'Active'}`, 'success');
    loadUsersData();
  } catch (error) {
    console.error('Error toggling user ban status:', error);
    showNotification('Failed to update user status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function deleteUser(userId) {
  showConfirmModal(
    'Are you sure you want to delete this user? This will delete their profile and all associated data (news, products, orders).',
    async () => {
      showLoading(true);
      try {
        const { error } = await state.supabase
          .from('profiles')
          .delete()
          .eq('id', userId);

        if (error) throw error;

        showNotification('User deleted successfully!', 'success');
        loadUsersData();
      } catch (error) {
        console.error('Error deleting user:', error);
        showNotification('Failed to delete user: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
  );
}

async function postNews() { // For Admin News
  const title = document.getElementById('news-title').value.trim();
  const content = document.getElementById('news-content').value.trim();
  const mediaFiles = document.getElementById('news-media').files;
  const youtubeLink = document.getElementById('news-youtube').value.trim();
  const tiktokLink = document.getElementById('news-tiktok').value.trim();
  const telegramLink = document.getElementById('news-telegram').value.trim();
  const facebookLink = document.getElementById('news-facebook').value.trim();

  if (!title || !content) {
    showNotification('Please enter news title and content.', 'warning');
    return;
  }

  showLoading(true);

  try {
    let mediaUrls = [];
    for (let i = 0; i < mediaFiles.length; i++) {
      const file = mediaFiles[i];
      const fileExt = file.name.split('.').pop();
      const fileName = `news_media/${state.adminProfile.id}_${Date.now()}_${i}.${fileExt}`;
      
      const { data: uploadData, error: uploadError } = await state.supabase.storage
        .from('news_media')
        .upload(fileName, file, {
          cacheControl: '3600',
          upsert: false
        });
        
      if (uploadError) throw uploadError;
      
      const { data: urlData } = state.supabase.storage
        .from('news_media')
        .getPublicUrl(fileName);
        
      mediaUrls.push({ url: urlData.publicUrl, type: file.type, size: file.size });
    }

    const { error } = await state.supabase
      .from('news')
      .insert({
        admin_profile_id: state.adminProfile.id,
        title,
        content,
        media_urls: mediaUrls.length > 0 ? mediaUrls : null,
        youtube_link: youtubeLink || null,
        tiktok_link: tiktokLink || null,
        telegram_link: telegramLink || null,
        facebook_link: facebookLink || null,
        is_published: true
      });

    if (error) throw error;

    // Clear form
    document.getElementById('news-title').value = '';
    document.getElementById('news-content').value = '';
    document.getElementById('news-media').value = '';
    document.getElementById('news-youtube').value = '';
    document.getElementById('news-tiktok').value = '';
    document.getElementById('news-telegram').value = '';
    document.getElementById('news-facebook').value = '';

    showNotification('News posted successfully!', 'success');
    loadNewsData();
  } catch (error) {
    console.error('Error posting news:', error);
    showNotification('Failed to post news: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

async function loadNewsData() {
  const adminNewsTableBody = document.getElementById('admin-news-table-body');
  const userNewsTableBody = document.getElementById('user-news-table-body');

  adminNewsTableBody.innerHTML = `
    <tr>
      <td colspan="5" class="text-center text-text-secondary py-8">
        <div class="loading-spinner mx-auto mb-2"></div>
        Loading admin news...
      </td>
    </tr>
  `;
  userNewsTableBody.innerHTML = `
    <tr>
      <td colspan="6" class="text-center text-text-secondary py-8">
        <div class="loading-spinner mx-auto mb-2"></div>
        Loading user news...
      </td>
    </tr>
  `;

  try {
    // Load Admin News
    const { data: adminNews, error: adminError } = await state.supabase
      .from('news')
      .select('*')
      .order('created_at', { ascending: false });
    if (adminError) throw adminError;
    state.allAdminNews = adminNews || [];
    renderAdminNews(state.allAdminNews);

    // Load User News
    const { data: userNews, error: userError } = await state.supabase
      .from('profile_news')
      .select(`
        *,
        profiles(username, name)
      `)
      .order('created_at', { ascending: false });
    if (userError) throw userError;
    state.allUserNews = userNews || [];
    renderUserNews(state.allUserNews);

  } catch (error) {
    console.error('Error loading news:', error);
    adminNewsTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-accent-red py-8">
          <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
          <p>Failed to retrieve admin news</p>
        </td>
      </tr>
    `;
    userNewsTableBody.innerHTML = `
      <tr>
        <td colspan="6" class="text-center text-accent-red py-8">
          <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
          <p>Failed to retrieve user news</p>
        </td>
      </tr>
    `;
  }
}

function renderAdminNews(newsToRender) {
  const adminNewsTableBody = document.getElementById('admin-news-table-body');
  if (newsToRender && newsToRender.length > 0) {
    adminNewsTableBody.innerHTML = newsToRender.map(news => {
      const statusClass = news.is_published ? 'status-active' : 'status-inactive';
      const statusText = news.is_published ? 'PUBLISHED' : 'DRAFT';
      
      return `
        <tr>
          <td>${news.title}</td>
          <td>${news.views || 0}</td>
          <td>${news.likes || 0}</td>
          <td class="${statusClass}">${statusText}</td>
          <td class="table-actions">
            <button onclick="viewNews('${news.id}')" class="myanmar-btn btn-small">
              <i class="fas fa-eye"></i>
            </button>
            <button onclick="toggleNewsPublishStatus('${news.id}', ${news.is_published})" class="myanmar-btn btn-small">
              <i class="fas ${news.is_published ? 'fa-eye-slash' : 'fa-eye'}"></i>
            </button>
            <button onclick="deleteNews('${news.id}')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    adminNewsTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-text-secondary py-8">
          <i class="fas fa-newspaper text-4xl mb-4"></i>
          <p>No Admin News Found</p>
        </td>
      </tr>
    `;
  }
}

function renderUserNews(newsToRender) {
  const userNewsTableBody = document.getElementById('user-news-table-body');
  if (newsToRender && newsToRender.length > 0) {
    userNewsTableBody.innerHTML = newsToRender.map(news => {
      const statusClass = news.is_published ? 'status-active' : 'status-inactive';
      const statusText = news.is_published ? 'PUBLISHED' : 'DRAFT';
      const authorName = news.profiles?.name || 'Unknown';
      const authorUsername = news.profiles?.username || 'unknown';
      
      return `
        <tr>
          <td>${news.title}</td>
          <td>${authorName} (@${authorUsername})</td>
          <td>${news.views || 0}</td>
          <td>${news.likes || 0}</td>
          <td class="${statusClass}">${statusText}</td>
          <td class="table-actions">
            <button onclick="viewProfileNews('${news.id}')" class="myanmar-btn btn-small">
              <i class="fas fa-eye"></i>
            </button>
            <button onclick="toggleProfileNewsPublishStatus('${news.id}', ${news.is_published})" class="myanmar-btn btn-small">
              <i class="fas ${news.is_published ? 'fa-eye-slash' : 'fa-eye'}"></i>
            </button>
            <button onclick="deleteProfileNews('${news.id}')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    userNewsTableBody.innerHTML = `
      <tr>
        <td colspan="6" class="text-center text-text-secondary py-8">
          <i class="fas fa-newspaper text-4xl mb-4"></i>
          <p>No User News Found</p>
        </td>
      </tr>
    `;
  }
}

async function viewNews(newsId) { // For Admin News
  showLoading(true);
  try {
    const { data, error } = await state.supabase
      .from('news')
      .select(`
        *,
        admin_profiles(username, name, profile_picture)
      `)
      .eq('id', newsId)
      .single();

    if (error) throw error;

    const author = data.admin_profiles;
    const authorName = author?.name || 'Unknown';
    const authorUsername = author?.username || 'unknown';
    const authorAvatar = author?.profile_picture || '/placeholder.svg?height=40&width=40';

    let mediaHtml = '';
    if (data.media_urls && data.media_urls.length > 0) {
      data.media_urls.forEach(media => {
        const mediaType = utils.getMediaType(media.type);
        if (mediaType === 'image') {
          mediaHtml += `<img src="${media.url}" class="w-full rounded-lg mb-3 object-cover" alt="News image">`;
        } else if (mediaType === 'video') {
          mediaHtml += `
            <div class="video-container mb-3">
              <video controls playsinline webkit-playsinline class="w-full rounded-lg">
                <source src="${media.url}" type="${media.type}">
              </video>
            </div>
          `;
        } else if (mediaType === 'audio') {
          mediaHtml += `
            <div class="audio-container mb-3">
              <audio controls class="w-full">
                <source src="${media.url}" type="${media.type}">
              </audio>
            </div>
          `;
        }
      });
    }

    let socialLinksHtml = '';
    if (data.youtube_link) socialLinksHtml += `<a href="${data.youtube_link}" target="_blank" class="text-red-500 hover:text-red-400"><i class="fab fa-youtube text-2xl"></i></a>`;
    if (data.tiktok_link) socialLinksHtml += `<a href="${data.tiktok_link}" target="_blank" class="text-text-secondary hover:text-text-primary"><i class="fab fa-tiktok text-2xl"></i></a>`;
    if (data.telegram_link) socialLinksHtml += `<a href="${data.telegram_link}" target="_blank" class="text-blue-400 hover:text-blue-300"><i class="fab fa-telegram text-2xl"></i></a>`;
    if (data.facebook_link) socialLinksHtml += `<a href="${data.facebook_link}" target="_blank" class="text-blue-600 hover:text-blue-500"><i class="fab fa-facebook text-2xl"></i></a>`;


    document.getElementById('news-modal-content').innerHTML = `
      <div class="space-y-4">
        <div class="flex items-center space-x-3">
          <img src="${authorAvatar}" 
               alt="Author" class="w-10 h-10 rounded-full object-cover">
          <div>
            <h4 class="font-semibold text-text-primary">${authorName} (Admin)</h4>
            <p class="text-sm text-text-secondary">@${authorUsername}</p>
          </div>
        </div>
        
        <h3 class="text-xl font-bold text-accent-purple">${data.title}</h3>
        
        ${mediaHtml}
        
        <div class="prose prose-invert max-w-none">
          <p class="text-text-secondary whitespace-pre-wrap">${data.content}</p>
        </div>
        
        ${socialLinksHtml ? `<div class="flex space-x-4 mt-4">${socialLinksHtml}</div>` : ''}

        <div class="flex items-center justify-between text-sm text-text-secondary pt-4 border-t border-border-color">
          <div class="flex space-x-4">
            <span><i class="fas fa-eye mr-1"></i> ${data.views || 0} VIEWS</span>
            <span><i class="fas fa-heart mr-1"></i> ${data.likes || 0} LIKES</span>
          </div>
          <span><i class="fas fa-calendar mr-1"></i> ${new Date(data.created_at).toLocaleString('my-MM')}</span>
        </div>
      </div>
    `;

    document.getElementById('news-modal').classList.remove('hidden');

  } catch (error) {
    console.error('Error viewing news:', error);
    showNotification('Failed to view News', 'error');
  } finally {
    showLoading(false);
  }
}

function closeNewsModal() {
  document.getElementById('news-modal').classList.add('hidden');
}

async function viewProfileNews(newsId) { // For User-posted News
  showLoading(true);
  try {
    const { data, error } = await state.supabase
      .from('profile_news')
      .select(`
        *,
        profiles(username, name, profile_picture)
      `)
      .eq('id', newsId)
      .single();

    if (error) throw error;

    const author = data.profiles;
    const authorName = author?.name || 'Unknown';
    const authorUsername = author?.username || 'unknown';
    const authorAvatar = author?.profile_picture || '/placeholder.svg?height=40&width=40';

    let mediaHtml = '';
    if (data.media_urls && data.media_urls.length > 0) {
      data.media_urls.forEach(media => {
        const mediaType = utils.getMediaType(media.type);
        if (mediaType === 'image') {
          mediaHtml += `<img src="${media.url}" class="w-full rounded-lg mb-3 object-cover" alt="News image">`;
        } else if (mediaType === 'video') {
          mediaHtml += `
            <div class="video-container mb-3">
              <video controls playsinline webkit-playsinline class="w-full rounded-lg">
                <source src="${media.url}" type="${media.type}">
              </video>
            </div>
          `;
        } else if (mediaType === 'audio') {
          mediaHtml += `
            <div class="audio-container mb-3">
              <audio controls class="w-full">
                <source src="${media.url}" type="${media.type}">
              </audio>
            </div>
          `;
        }
      });
    }

    let socialLinksHtml = '';
    if (data.youtube_link) socialLinksHtml += `<a href="${data.youtube_link}" target="_blank" class="text-red-500 hover:text-red-400"><i class="fab fa-youtube text-2xl"></i></a>`;
    if (data.tiktok_link) socialLinksHtml += `<a href="${data.tiktok_link}" target="_blank" class="text-text-secondary hover:text-text-primary"><i class="fab fa-tiktok text-2xl"></i></a>`;
    if (data.telegram_link) socialLinksHtml += `<a href="${data.telegram_link}" target="_blank" class="text-blue-400 hover:text-blue-300"><i class="fab fa-telegram text-2xl"></i></a>`;
    if (data.facebook_link) socialLinksHtml += `<a href="${data.facebook_link}" target="_blank" class="text-blue-600 hover:text-blue-500"><i class="fab fa-facebook text-2xl"></i></a>`;


    document.getElementById('profile-news-modal-content').innerHTML = `
      <div class="space-y-4">
        <div class="flex items-center space-x-3">
          <img src="${authorAvatar}" 
               alt="Author" class="w-10 h-10 rounded-full object-cover">
          <div>
            <h4 class="font-semibold text-text-primary">${authorName}</h4>
            <p class="text-sm text-text-secondary">@${authorUsername}</p>
          </div>
        </div>
        
        <h3 class="text-xl font-bold text-accent-purple">${data.title}</h3>
        
        ${mediaHtml}
        
        <div class="prose prose-invert max-w-none">
          <p class="text-text-secondary whitespace-pre-wrap">${data.content}</p>
        </div>
        
        ${socialLinksHtml ? `<div class="flex space-x-4 mt-4">${socialLinksHtml}</div>` : ''}

        <div class="flex items-center justify-between text-sm text-text-secondary pt-4 border-t border-border-color">
          <div class="flex space-x-4">
            <span><i class="fas fa-eye mr-1"></i> ${data.views || 0} VIEWS</span>
            <span><i class="fas fa-heart mr-1"></i> ${data.likes || 0} LIKES</span>
          </div>
          <span><i class="fas fa-calendar mr-1"></i> ${new Date(data.created_at).toLocaleString('my-MM')}</span>
        </div>
      </div>
    `;

    document.getElementById('profile-news-modal').classList.remove('hidden');

  } catch (error) {
    console.error('Error viewing profile news:', error);
    showNotification('Failed to view Profile News', 'error');
  } finally {
    showLoading(false);
  }
}

function closeProfileNewsModal() {
  document.getElementById('profile-news-modal').classList.add('hidden');
}

async function toggleNewsPublishStatus(newsId, currentStatus) { // For Admin News
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('news')
      .update({ is_published: !currentStatus })
      .eq('id', newsId);

    if (error) throw error;

    showNotification(`News status updated to ${!currentStatus ? 'Published' : 'Draft'}`, 'success');
    loadNewsData();
  } catch (error) {
    console.error('Error toggling news status:', error);
    showNotification('Failed to update news status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function deleteNews(newsId) { // For Admin News
  showConfirmModal(
    'Are you sure you want to delete this news post?',
    async () => {
      showLoading(true);
      try {
        const { error } = await state.supabase
          .from('news')
          .delete()
          .eq('id', newsId);

        if (error) throw error;

        showNotification('News post deleted successfully!', 'success');
        loadNewsData();
      } catch (error) {
        console.error('Error deleting news:', error);
        showNotification('Failed to delete news post: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
  );
}

async function toggleProfileNewsPublishStatus(newsId, currentStatus) { // For User News
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('profile_news')
      .update({ is_published: !currentStatus })
      .eq('id', newsId);

    if (error) throw error;

    showNotification(`User News status updated to ${!currentStatus ? 'Published' : 'Draft'}`, 'success');
    loadNewsData();
  } catch (error) {
    console.error('Error toggling user news status:', error);
    showNotification('Failed to update user news status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function deleteProfileNews(newsId) { // For User News
  showConfirmModal(
    'Are you sure you want to delete this user news post?',
    async () => {
      showLoading(true);
      try {
        const { error } = await state.supabase
          .from('profile_news')
          .delete()
          .eq('id', newsId);

        if (error) throw error;

        showNotification('User News post deleted successfully!', 'success');
        loadNewsData();
      } catch (error) {
        console.error('Error deleting user news:', error);
        showNotification('Failed to delete user news post: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
  );
}

async function uploadProduct() { // For Admin Products
  const name = document.getElementById('product-name').value.trim();
  const description = document.getElementById('product-description').value.trim();
  const price = parseFloat(document.getElementById('product-price').value);
  const apkIconFile = document.getElementById('product-apk-icon').files[0];
  const apkFile = document.getElementById('product-apk-file').files[0];

  if (!name || !description || isNaN(price) || price < 0 || !apkFile) {
    showNotification('Please fill in all required fields (Name, Description, Price, APK File).', 'warning');
    return;
  }

  showLoading(true);

  try {
    let apkIconUrl = null;
    if (apkIconFile) {
      const iconExt = apkIconFile.name.split('.').pop();
      const iconFileName = `product_icons/${Date.now()}.${iconExt}`;
      const { data: uploadIconData, error: uploadIconError } = await state.supabase.storage
        .from('product_icons') // NEW bucket
        .upload(iconFileName, apkIconFile, { cacheControl: '3600', upsert: false });
      if (uploadIconError) throw uploadIconError;
      const { data: iconUrlData } = state.supabase.storage.from('product_icons').getPublicUrl(iconFileName);
      apkIconUrl = iconUrlData.publicUrl;
    }

    const apkExt = apkFile.name.split('.').pop();
    const apkFileName = `apks/${name.replace(/\s/g, '_')}_${Date.now()}.${apkExt}`;
    const { data: uploadApkData, error: uploadApkError } = await state.supabase.storage
      .from('apks') // NEW bucket
      .upload(apkFileName, apkFile, { cacheControl: '3600', upsert: false });
    if (uploadApkError) throw uploadApkError;
    const { data: apkUrlData } = state.supabase.storage.from('apks').getPublicUrl(apkFileName);
    const fileUrl = apkUrlData.publicUrl;

    const { error } = await state.supabase
      .from('products')
      .insert({
        name,
        description,
        price,
        apk_icon_url: apkIconUrl,
        file_url: fileUrl,
        is_active: true
      });

    if (error) throw error;

    // Clear form
    document.getElementById('product-name').value = '';
    document.getElementById('product-description').value = '';
    document.getElementById('product-price').value = '';
    document.getElementById('product-apk-icon').value = '';
    document.getElementById('product-apk-file').value = '';

    showNotification('Product uploaded successfully!', 'success');
    loadProductsData();
  } catch (error) {
    console.error('Error uploading product:', error);
    showNotification('Failed to upload product: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

async function loadProductsData() { // For Admin Products
  const productsTableBody = document.getElementById('products-table-body');
  productsTableBody.innerHTML = `
    <tr>
      <td colspan="5" class="text-center text-text-secondary py-8">
        <div class="loading-spinner mx-auto mb-2"></div>
        Loading products...
      </td>
    </tr>
  `;

  try {
    const { data: products, error } = await state.supabase
      .from('products')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) throw error;

    state.allProducts = products || []; // Cache for filtering
    renderProducts(state.allProducts);

  } catch (error) {
    console.error('Error loading products:', error);
    productsTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-accent-red py-8">
          <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
          <p>Failed to retrieve products</p>
        </td>
      </tr>
    `;
  }
}

function renderProducts(productsToRender) {
  const productsTableBody = document.getElementById('products-table-body');
  if (productsToRender && productsToRender.length > 0) {
    productsTableBody.innerHTML = productsToRender.map(product => {
      const statusClass = product.is_active ? 'status-active' : 'status-inactive';
      const statusText = product.is_active ? 'ACTIVE' : 'INACTIVE';
      const iconUrl = product.apk_icon_url || '/placeholder.svg?height=40&width=40';
      
      return `
        <tr>
          <td><img src="${iconUrl}" class="w-10 h-10 object-contain rounded-md" alt="Icon"></td>
          <td>${product.name}</td>
          <td>${utils.formatPrice(product.price)}</td>
          <td class="${statusClass}">${statusText}</td>
          <td class="table-actions">
            <button onclick="viewProduct('${product.id}')" class="myanmar-btn btn-small">
              <i class="fas fa-eye"></i>
            </button>
            <button onclick="toggleProductStatus('${product.id}', ${product.is_active})" class="myanmar-btn btn-small">
              <i class="fas ${product.is_active ? 'fa-eye-slash' : 'fa-eye'}"></i>
            </button>
            <button onclick="deleteProduct('${product.id}')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    productsTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-text-secondary py-8">
          <i class="fas fa-box-open text-4xl mb-4"></i>
          <p>No Products Found</p>
        </td>
      </tr>
    `;
  }
}

async function viewProduct(productId) { // For Admin Products
  showLoading(true);
  try {
    const { data: product, error } = await state.supabase
      .from('products')
      .select('*')
      .eq('id', productId)
      .single();

    if (error) throw error;

    document.getElementById('product-modal-content').innerHTML = `
      <div class="space-y-4">
        <div class="flex items-center space-x-3 mb-4">
          <img src="${product.apk_icon_url || '/placeholder.svg?height=64&width=64'}" 
               alt="Product Icon" class="w-16 h-16 object-contain">
          <div>
            <h3 class="text-xl font-bold text-accent-purple">${product.name}</h3>
            <p class="text-text-secondary text-sm">${utils.formatPrice(product.price)}</p>
          </div>
        </div>
        
        <p class="text-text-secondary whitespace-pre-wrap">${product.description || 'No description provided.'}</p>
        
        <div class="flex justify-between items-center text-sm text-text-secondary pt-4 border-t border-border-color">
          <span>Status: <span class="${product.is_active ? 'status-active' : 'status-inactive'}">${product.is_active ? 'ACTIVE' : 'INACTIVE'}</span></span>
          <span>Created: ${new Date(product.created_at).toLocaleDateString('my-MM')}</span>
        </div>
        <div class="mt-4">
          <a href="${product.file_url}" target="_blank" download class="myanmar-btn w-full">
            <i class="fas fa-download mr-2"></i> DOWNLOAD APK
          </a>
        </div>
      </div>
    `;

    document.getElementById('product-modal').classList.remove('hidden');

  } catch (error) {
    console.error('Error viewing product:', error);
    showNotification('Failed to view Product: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function closeProductModal() { // For Admin Products
  document.getElementById('product-modal').classList.add('hidden');
}

async function toggleProductStatus(productId, currentStatus) { // For Admin Products
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('products')
      .update({ is_active: !currentStatus })
      .eq('id', productId);

    if (error) throw error;

    showNotification(`Product status updated to ${!currentStatus ? 'Active' : 'Inactive'}`, 'success');
    loadProductsData();
  } catch (error) {
    console.error('Error toggling product status:', error);
    showNotification('Failed to update product status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function deleteProduct(productId) { // For Admin Products
  showConfirmModal(
    'Are you sure you want to delete this product? This will also remove all associated orders.',
    async () => {
      showLoading(true);
      try {
        const { error } = await state.supabase
          .from('products')
          .delete()
          .eq('id', productId);

        if (error) throw error;

        showNotification('Product deleted successfully!', 'success');
        loadProductsData();
      } catch (error) {
        console.error('Error deleting product:', error);
        showNotification('Failed to delete product: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
  );
}

async function loadUserProductsData() { // For User Products
  const userProductsTableBody = document.getElementById('all-user-products-table-body');
  userProductsTableBody.innerHTML = `
    <tr>
      <td colspan="6" class="text-center text-text-secondary py-8">
        <div class="loading-spinner mx-auto mb-2"></div>
        Loading user products...
      </td>
    </tr>
  `;

  try {
    const { data: products, error } = await state.supabase
      .from('user_products')
      .select(`
        *,
        profiles(username, name)
      `)
      .order('created_at', { ascending: false });

    if (error) throw error;

    state.allUserProducts = products || []; // Cache for filtering
    renderUserProducts(state.allUserProducts);

  } catch (error) {
    console.error('Error loading user products:', error);
    userProductsTableBody.innerHTML = `
      <tr>
        <td colspan="6" class="text-center text-accent-red py-8">
          <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
          <p>Failed to retrieve user products</p>
        </td>
      </tr>
    `;
  }
}

function renderUserProducts(productsToRender) {
  const userProductsTableBody = document.getElementById('all-user-products-table-body');
  if (productsToRender && productsToRender.length > 0) {
    userProductsTableBody.innerHTML = productsToRender.map(product => {
      const statusClass = product.is_active ? (product.is_sold_out ? 'status-inactive' : 'status-active') : 'status-inactive';
      const statusText = product.is_active ? (product.is_sold_out ? 'SOLD OUT' : 'ACTIVE') : 'INACTIVE';
      const productImageUrl = product.image_urls && product.image_urls.length > 0 ? product.image_urls[0].url : '/placeholder.svg?height=50&width=50';
      const sellerName = product.profiles?.name || 'Unknown';
      const sellerUsername = product.profiles?.username || 'unknown';
      
      return `
        <tr>
          <td><img src="${productImageUrl}" class="w-12 h-12 object-cover rounded-md" alt="${product.name}"></td>
          <td>${product.name}</td>
          <td>${sellerName} (@${sellerUsername})</td>
          <td>${utils.formatPrice(product.price)}</td>
          <td class="${statusClass}">${statusText}</td>
          <td class="table-actions">
            <button onclick="viewUserProduct('${product.id}')" class="myanmar-btn btn-small">
              <i class="fas fa-eye"></i>
            </button>
            <button onclick="toggleUserProductStatus('${product.id}', ${product.is_active})" class="myanmar-btn btn-small">
              <i class="fas ${product.is_active ? 'fa-eye-slash' : 'fa-eye'}"></i>
            </button>
            <button onclick="toggleUserProductSoldOut('${product.id}', ${product.is_sold_out})" class="myanmar-btn btn-small">
              <i class="fas ${product.is_sold_out ? 'fa-check-circle' : 'fa-times-circle'}"></i>
            </button>
            <button onclick="deleteUserProduct('${product.id}')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    userProductsTableBody.innerHTML = `
      <tr>
        <td colspan="6" class="text-center text-text-secondary py-8">
          <i class="fas fa-store text-4xl mb-4"></i>
          <p>No User Products Found</p>
        </td>
      </tr>
    `;
  }
}

async function viewUserProduct(productId) { // For User Products
  showLoading(true);
  try {
    const { data: product, error } = await state.supabase
      .from('user_products')
      .select(`
        *,
        profiles(username, name, profile_picture)
      `)
      .eq('id', productId)
      .single();

    if (error) throw error;
    if (!product) throw new Error('Product not found.');

    const seller = product.profiles;
    const sellerName = seller?.name || 'Unknown Seller';
    const sellerUsername = seller?.username || 'unknown';
    const sellerAvatar = seller?.profile_picture || '/placeholder.svg?height=40&width=40';

    let imagesHtml = '';
    if (product.image_urls && product.image_urls.length > 0) {
      imagesHtml = product.image_urls.map(img => `<img src="${img.url}" class="w-full rounded-lg mb-3 object-cover max-h-96" alt="Product image">`).join('');
    } else {
      imagesHtml = `<img src="/placeholder.svg?height=300&width=500" class="w-full rounded-lg mb-3 object-cover max-h-96" alt="No image">`;
    }

    let socialLinksHtml = '';
    if (product.social_links && product.social_links.length > 0) {
      socialLinksHtml = product.social_links.map(link => `
        <a href="${link.url}" target="_blank" class="text-text-secondary hover:text-accent-purple flex items-center space-x-2">
          <i class="${link.icon || 'fas fa-link'} text-xl"></i><span>${link.name}</span>
        </a>
      `).join('');
    }

    let contactInfoHtml = '';
    if (product.contact_info && product.contact_info.length > 0) {
      contactInfoHtml = product.contact_info.map(info => `
        <p class="text-text-secondary text-sm"><i class="fas fa-info-circle mr-1"></i> ${info.name}: ${info.value}</p>
      `).join('');
    }

    document.getElementById('user-product-modal-content').innerHTML = `
      <div class="space-y-4">
        <div class="flex items-center space-x-3 mb-4">
          <img src="${sellerAvatar}" 
               alt="Author" class="w-10 h-10 rounded-full object-cover">
          <div>
            <h4 class="font-semibold text-text-primary">${sellerName}</h4>
            <p class="text-sm text-text-secondary">@${sellerUsername}</p>
          </div>
        </div>
        
        <h3 class="text-xl font-bold text-accent-purple">${product.name}</h3>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${imagesHtml}
        </div>

        <p class="text-text-secondary whitespace-pre-wrap">${product.description || 'No description provided.'}</p>
        
        <p class="text-2xl font-bold text-accent-green mb-3">${utils.formatPrice(product.price)}</p>

        ${socialLinksHtml ? `
          <div class="mt-4">
            <h4 class="font-semibold text-text-primary mb-2">Social Media:</h4>
            <div class="flex flex-wrap gap-4">${socialLinksHtml}</div>
          </div>
        ` : ''}

        ${contactInfoHtml ? `
          <div class="mt-4">
            <h4 class="font-semibold text-text-primary mb-2">Contact Info:</h4>
            <div class="space-y-1">${contactInfoHtml}</div>
          </div>
        ` : ''}
        
        <div class="flex justify-between items-center text-sm text-text-secondary pt-4 border-t border-border-color">
          <span>Status: <span class="${product.is_active ? 'status-active' : 'status-inactive'}">${product.is_active ? (product.is_sold_out ? 'SOLD OUT' : 'ACTIVE') : 'INACTIVE'}</span></span>
          <span>Created: ${new Date(product.created_at).toLocaleDateString('my-MM')}</span>
        </div>
      </div>
    `;

    document.getElementById('user-product-modal').classList.remove('hidden');

  } catch (error) {
    console.error('Error viewing user product:', error);
    showNotification('Failed to view User Product: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function closeUserProductModal() { // For User Products
  document.getElementById('user-product-modal').classList.add('hidden');
}

async function toggleUserProductStatus(productId, currentStatus) { // For User Products
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('user_products')
      .update({ is_active: !currentStatus })
      .eq('id', productId);

    if (error) throw error;

    showNotification(`User Product status updated to ${!currentStatus ? 'Active' : 'Inactive'}`, 'success');
    loadUserProductsData();
  } catch (error) {
    console.error('Error toggling user product status:', error);
    showNotification('Failed to update user product status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

async function toggleUserProductSoldOut(productId, currentSoldOutStatus) { // For User Products
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('user_products')
      .update({ is_sold_out: !currentSoldOutStatus })
      .eq('id', productId);

    if (error) throw error;

    showNotification(`User Product marked as ${!currentSoldOutStatus ? 'Sold Out' : 'Available'}`, 'success');
    loadUserProductsData();
  } catch (error) {
    console.error('Error toggling user product sold out status:', error);
    showNotification('Failed to update user product sold out status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function deleteUserProduct(productId) { // For User Products
  showConfirmModal(
    'Are you sure you want to delete this user product? This will also remove all associated orders.',
    async () => {
      showLoading(true);
      try {
        const { error } = await state.supabase
          .from('user_products')
          .delete()
          .eq('id', productId);

        if (error) throw error;

        showNotification('User Product deleted successfully!', 'success');
        loadUserProductsData();
      } catch (error) {
        console.error('Error deleting user product:', error);
        showNotification('Failed to delete user product: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
  );
}

async function loadAdminOrdersData() { // For Admin Product Orders
  const adminOrdersTableBody = document.getElementById('admin-orders-table-body');
  adminOrdersTableBody.innerHTML = `
    <tr>
      <td colspan="7" class="text-center text-text-secondary py-8">
        <div class="loading-spinner mx-auto mb-2"></div>
        Loading admin product orders...
      </td>
    </tr>
  `;

  try {
    const { data: orders, error } = await state.supabase
      .from('orders')
      .select(`
        *,
        products(name, price),
        profiles(username, name)
      `)
      .order('ordered_at', { ascending: false });

    if (error) throw error;

    state.allAdminOrders = orders || []; // Cache for filtering
    renderAdminOrders(state.allAdminOrders);

  } catch (error) {
    console.error('Error loading admin orders:', error);
    adminOrdersTableBody.innerHTML = `
      <tr>
        <td colspan="7" class="text-center text-accent-red py-8">
          <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
          <p>Failed to retrieve admin product orders</p>
        </td>
      </tr>
    `;
  }
}

function renderAdminOrders(ordersToRender) {
  const adminOrdersTableBody = document.getElementById('admin-orders-table-body');
  if (ordersToRender && ordersToRender.length > 0) {
    adminOrdersTableBody.innerHTML = ordersToRender.map(order => {
      const buyerName = order.profiles?.name || 'Unknown';
      const buyerUsername = order.profiles?.username || 'unknown';
      const productName = order.products?.name || 'N/A';
      const statusClass = {
        'pending': 'text-yellow-400',
        'approved': 'text-accent-green',
        'rejected': 'text-accent-red'
      }[order.status] || 'text-text-secondary';
      
      return `
        <tr>
          <td>${order.id.substring(0, 8)}...</td>
          <td>${buyerName} (@${buyerUsername})</td>
          <td>${productName}</td>
          <td>${utils.formatPrice(order.amount)}</td>
          <td>
            ${order.receipt_url ? `<a href="${order.receipt_url}" target="_blank" class="text-accent-purple hover:underline"><i class="fas fa-file-image mr-1"></i> View Receipt</a>` : 'N/A'}
          </td>
          <td class="${statusClass}">${order.status.toUpperCase()}</td>
          <td class="table-actions">
            ${order.status === 'pending' ? `
              <button onclick="updateAdminOrderStatus('${order.id}', 'approved')" class="myanmar-btn btn-small">
                <i class="fas fa-check"></i> Approve
              </button>
              <button onclick="updateAdminOrderStatus('${order.id}', 'rejected')" class="btn-danger myanmar-btn btn-small">
                <i class="fas fa-times"></i> Reject
              </button>
            ` : ''}
            <button onclick="deleteAdminOrder('${order.id}')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    adminOrdersTableBody.innerHTML = `
      <tr>
        <td colspan="7" class="text-center text-text-secondary py-8">
          <i class="fas fa-receipt text-4xl mb-4"></i>
          <p>No Admin Product Orders Found</p>
        </td>
      </tr>
    `;
  }
}

async function updateAdminOrderStatus(orderId, newStatus) {
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('orders')
      .update({ status: newStatus })
      .eq('id', orderId);

    if (error) throw error;

    // If approved, add to purchased_products
    if (newStatus === 'approved') {
      const { data: orderData, error: fetchOrderError } = await state.supabase
        .from('orders')
        .select('profile_id, product_id, amount')
        .eq('id', orderId)
        .single();
      
      if (fetchOrderError) throw fetchOrderError;

      const { error: insertPurchasedError } = await state.supabase
        .from('purchased_products')
        .insert({
          profile_id: orderData.profile_id,
          product_id: orderData.product_id,
          price_at_purchase: orderData.amount
        });
      if (insertPurchasedError && insertPurchasedError.code !== '23505') { // Ignore unique constraint error if already purchased
        throw insertPurchasedError;
      }
    }

    showNotification(`Order ${orderId.substring(0, 8)}... status updated to ${newStatus.toUpperCase()}`, 'success');
    loadAdminOrdersData();
  } catch (error) {
    console.error('Error updating admin order status:', error);
    showNotification('Failed to update order status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function deleteAdminOrder(orderId) {
  showConfirmModal(
    'Are you sure you want to delete this order?',
    async () => {
      showLoading(true);
      try {
        const { error } = await state.supabase
          .from('orders')
          .delete()
          .eq('id', orderId);

        if (error) throw error;

        showNotification('Order deleted successfully!', 'success');
        loadAdminOrdersData();
      } catch (error) {
        console.error('Error deleting order:', error);
        showNotification('Failed to delete order: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
  );
}

async function loadUserOrdersData() { // For User Product Orders
  const userOrdersTableBody = document.getElementById('user-orders-table-body');
  userOrdersTableBody.innerHTML = `
    <tr>
      <td colspan="8" class="text-center text-text-secondary py-8">
        <div class="loading-spinner mx-auto mb-2"></div>
        Loading user product orders...
      </td>
    </tr>
  `;

  try {
    const { data: orders, error } = await state.supabase
      .from('user_orders')
      .select(`
        *,
        user_products(name, price),
        buyer_profile:profiles!buyer_profile_id(username, name),
        seller_profile:profiles!seller_profile_id(username, name)
      `)
      .order('ordered_at', { ascending: false });

    if (error) throw error;

    state.allUserOrders = orders || []; // Cache for filtering
    renderUserOrders(state.allUserOrders);

  } catch (error) {
    console.error('Error loading user orders:', error);
    userOrdersTableBody.innerHTML = `
      <tr>
        <td colspan="8" class="text-center text-accent-red py-8">
          <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
          <p>Failed to retrieve user product orders</p>
        </td>
      </tr>
    `;
  }
}

function renderUserOrders(ordersToRender) {
  const userOrdersTableBody = document.getElementById('user-orders-table-body');
  if (ordersToRender && ordersToRender.length > 0) {
    userOrdersTableBody.innerHTML = ordersToRender.map(order => {
      const buyerName = order.buyer_profile?.name || 'Unknown Buyer';
      const buyerUsername = order.buyer_profile?.username || 'unknown';
      const sellerName = order.seller_profile?.name || 'Unknown Seller';
      const sellerUsername = order.seller_profile?.username || 'unknown';
      const productName = order.user_products?.name || 'N/A';
      const statusClass = {
        'pending': 'text-yellow-400',
        'approved': 'text-accent-green',
        'rejected': 'text-accent-red',
        'delivered': 'text-blue-400',
        'cancelled': 'text-gray-400'
      }[order.status] || 'text-text-secondary';
      
      return `
        <tr>
          <td>${order.id.substring(0, 8)}...</td>
          <td>${buyerName} (@${buyerUsername})</td>
          <td>${sellerName} (@${sellerUsername})</td>
          <td>${productName}</td>
          <td>${utils.formatPrice(order.amount)}</td>
          <td>
            ${order.receipt_url ? `<a href="${order.receipt_url}" target="_blank" class="text-accent-purple hover:underline"><i class="fas fa-file-image mr-1"></i> View Receipt</a>` : 'N/A'}
          </td>
          <td class="${statusClass}">${order.status.toUpperCase()}</td>
          <td class="table-actions">
            <button onclick="updateUserProductOrderStatus('${order.id}', 'approved')" class="myanmar-btn btn-small">
              <i class="fas fa-check"></i> Approve
            </button>
            <button onclick="updateUserProductOrderStatus('${order.id}', 'rejected')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-times"></i> Reject
            </button>
            <button onclick="updateUserProductOrderStatus('${order.id}', 'delivered')" class="myanmar-btn btn-small">
              <i class="fas fa-truck"></i> Deliver
            </button>
            <button onclick="updateUserProductOrderStatus('${order.id}', 'cancelled')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-ban"></i> Cancel
            </button>
            <button onclick="viewOrderSlip('${order.id}')" class="myanmar-btn btn-small">
              <i class="fas fa-file-invoice"></i> Slip
            </button>
            <button onclick="deleteUserProductOrder('${order.id}')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    userOrdersTableBody.innerHTML = `
      <tr>
        <td colspan="8" class="text-center text-text-secondary py-8">
          <i class="fas fa-receipt text-4xl mb-4"></i>
          <p>No User Product Orders Found</p>
        </td>
      </tr>
    `;
  }
}

async function updateUserProductOrderStatus(orderId, newStatus) {
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('user_orders')
      .update({ status: newStatus })
      .eq('id', orderId);

    if (error) throw error;

    showNotification(`User Order ${orderId.substring(0, 8)}... status updated to ${newStatus.toUpperCase()}`, 'success');
    loadUserOrdersData();
  } catch (error) {
    console.error('Error updating user product order status:', error);
    showNotification('Failed to update user product order status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function deleteUserProductOrder(orderId) {
  showConfirmModal(
    'Are you sure you want to delete this user product order?',
    async () => {
      showLoading(true);
      try {
        const { error } = await state.supabase
          .from('user_orders')
          .delete()
          .eq('id', orderId);

        if (error) throw error;

        showNotification('User Product Order deleted successfully!', 'success');
        loadUserOrdersData();
      } catch (error) {
        console.error('Error deleting user product order:', error);
        showNotification('Failed to delete user product order: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
  );
}

async function viewOrderSlip(orderId) {
  showLoading(true);
  try {
    const { data: order, error } = await state.supabase
      .from('user_orders')
      .select(`
        *,
        user_products(name, description, price, image_urls),
        buyer_profile:profiles!buyer_profile_id(username, name, profile_picture),
        seller_profile:profiles!seller_profile_id(username, name, profile_picture)
      `)
      .eq('id', orderId)
      .single();

    if (error) throw error;
    if (!order) throw new Error('Order not found.');

    const productName = order.user_products?.name || 'N/A';
    const productPrice = order.user_products?.price || 0;
    const buyerName = order.buyer_profile?.name || 'N/A';
    const buyerUsername = order.buyer_profile?.username || 'N/A';
    const sellerName = order.seller_profile?.name || 'N/A';
    const sellerUsername = order.seller_profile?.username || 'N/A';
    const orderDate = new Date(order.ordered_at).toLocaleString('my-MM');

    let productImagesHtml = '';
    if (order.user_products?.image_urls && order.user_products.image_urls.length > 0) {
      productImagesHtml = order.user_products.image_urls.map(img => `<img src="${img.url}" alt="Product Image" class="slip-image">`).join('');
    }

    document.getElementById('order-slip-content').innerHTML = `
      <div class="slip-header">
        <h2>ORDER RECEIPT</h2>
        <p>FPS GFX Tool Shop</p>
      </div>
      <div class="slip-details">
        <p><strong>Order ID:</strong> ${order.id}</p>
        <p><strong>Order Date:</strong> ${orderDate}</p>
        <p><strong>Status:</strong> <span class="font-bold">${order.status.toUpperCase()}</span></p>
        <p><strong>Buyer:</strong> ${buyerName} (@${buyerUsername})</p>
        <p><strong>Seller:</strong> ${sellerName} (@${sellerUsername})</p>
        ${order.buyer_notes ? `<p><strong>Buyer Notes:</strong> ${order.buyer_notes}</p>` : ''}
      </div>
      <div class="slip-items">
        <h3>Order Items:</h3>
        <div class="item">
          <p><strong>Product:</strong> ${productName}</p>
          <p><strong>Price:</strong> ${utils.formatPrice(productPrice)}</p>
          <p><strong>Quantity:</strong> 1</p>
        </div>
      </div>
      <div class="slip-total">
        Total Amount: ${utils.formatPrice(order.amount)}
      </div>
      ${order.receipt_url ? `
        <div class="mt-4 text-center">
          <p class="text-sm text-gray-600 mb-2">Buyer's Payment Receipt:</p>
          <a href="${order.receipt_url}" target="_blank" class="text-blue-500 hover:underline">View Uploaded Receipt</a>
        </div>
      ` : ''}
      ${productImagesHtml ? `
        <div class="slip-images">
          ${productImagesHtml}
        </div>
      ` : ''}
      <div class="slip-footer">
        <p>Thank you for your purchase!</p>
        <p>Powered by FPS GFX Tool</p>
      </div>
    `;

    document.getElementById('order-slip-modal').classList.remove('hidden');
  } catch (error) {
    console.error('Error viewing order slip:', error);
    showNotification('Failed to load order slip: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function closeOrderSlipModal() {
  document.getElementById('order-slip-modal').classList.add('hidden');
}

function printOrderSlip() {
  window.print();
}

function downloadOrderSlip() {
  const element = document.getElementById('order-slip-content');
  const opt = {
    margin: 1,
    filename: `order_slip_${new Date().toISOString().slice(0,10)}.pdf`,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
  };
  html2pdf().set(opt).from(element).save();
}

async function addPaymentMethod() { // For Admin Payment Methods
  const methodName = document.getElementById('payment-method-name').value.trim();
  const accountInfo = document.getElementById('payment-account-info').value.trim();
  const instructions = document.getElementById('payment-instructions').value.trim();
  const qrCodeFile = document.getElementById('payment-qr-code').files[0];

  if (!methodName || !accountInfo) {
    showNotification('Please enter Method Name and Account Info.', 'warning');
    return;
  }

  showLoading(true);

  try {
    let qrCodeUrl = null;
    if (qrCodeFile) {
      const fileExt = qrCodeFile.name.split('.').pop();
      const fileName = `payment_qrcodes/${Date.now()}.${fileExt}`;
      
      const { data: uploadData, error: uploadError } = await state.supabase.storage
        .from('payment_qr_codes') // NEW bucket
        .upload(fileName, qrCodeFile, {
          cacheControl: '3600',
          upsert: false
        });
        
      if (uploadError) throw uploadError;
      
      const { data: urlData } = state.supabase.storage
        .from('payment_qr_codes')
        .getPublicUrl(fileName);
        
      qrCodeUrl = urlData.publicUrl;
    }

    const { error } = await state.supabase
      .from('payment_methods')
      .insert({
        method_name: methodName,
        account_info: accountInfo,
        qr_code_url: qrCodeUrl,
        instructions: instructions || null,
        is_active: true
      });

    if (error) throw error;

    // Clear form
    document.getElementById('payment-method-name').value = '';
    document.getElementById('payment-account-info').value = '';
    document.getElementById('payment-instructions').value = '';
    document.getElementById('payment-qr-code').value = '';

    showNotification('Payment method added successfully!', 'success');
    loadPaymentMethodsData();
  } catch (error) {
    console.error('Error adding payment method:', error);
    showNotification('Failed to add payment method: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

async function loadPaymentMethodsData() { // For Admin Payment Methods
  const paymentMethodsTableBody = document.getElementById('payment-methods-table-body');
  paymentMethodsTableBody.innerHTML = `
    <tr>
      <td colspan="5" class="text-center text-text-secondary py-8">
        <div class="loading-spinner mx-auto mb-2"></div>
        Loading payment methods...
      </td>
    </tr>
  `;

  try {
    const { data: methods, error } = await state.supabase
      .from('payment_methods')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) throw error;

    state.allPaymentMethods = methods || []; // Cache for filtering
    renderPaymentMethods(state.allPaymentMethods);

  } catch (error) {
    console.error('Error loading payment methods:', error);
    paymentMethodsTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-accent-red py-8">
          <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
          <p>Failed to retrieve payment methods</p>
        </td>
      </tr>
    `;
  }
}

function renderPaymentMethods(methodsToRender) {
  const paymentMethodsTableBody = document.getElementById('payment-methods-table-body');
  if (methodsToRender && methodsToRender.length > 0) {
    paymentMethodsTableBody.innerHTML = methodsToRender.map(method => {
      const statusClass = method.is_active ? 'status-active' : 'status-inactive';
      const statusText = method.is_active ? 'ACTIVE' : 'INACTIVE';
      
      return `
        <tr>
          <td>${method.method_name}</td>
          <td>${method.account_info}</td>
          <td>
            ${method.qr_code_url ? `<img src="${method.qr_code_url}" class="w-16 h-16 object-contain rounded-md" alt="QR Code">` : 'N/A'}
          </td>
          <td class="${statusClass}">${statusText}</td>
          <td class="table-actions">
            <button onclick="togglePaymentMethodStatus('${method.id}', ${method.is_active})" class="myanmar-btn btn-small">
              <i class="fas ${method.is_active ? 'fa-eye-slash' : 'fa-eye'}"></i>
            </button>
            <button onclick="deletePaymentMethod('${method.id}')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    paymentMethodsTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-text-secondary py-8">
          <i class="fas fa-wallet text-4xl mb-4"></i>
          <p>No Payment Methods Found</p>
        </td>
      </tr>
    `;
  }
}

async function togglePaymentMethodStatus(methodId, currentStatus) { // For Admin Payment Methods
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('payment_methods')
      .update({ is_active: !currentStatus })
      .eq('id', methodId);

    if (error) throw error;

    showNotification(`Payment method status updated to ${!currentStatus ? 'Active' : 'Inactive'}`, 'success');
    loadPaymentMethodsData();
  } catch (error) {
    console.error('Error toggling payment method status:', error);
    showNotification('Failed to update payment method status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function deletePaymentMethod(methodId) { // For Admin Payment Methods
  showConfirmModal(
    'Are you sure you want to delete this payment method?',
    async () => {
      showLoading(true);
      try {
        const { error } = await state.supabase
          .from('payment_methods')
          .delete()
          .eq('id', methodId);

        if (error) throw error;

        showNotification('Payment method deleted successfully!', 'success');
        loadPaymentMethodsData();
      } catch (error) {
        console.error('Error deleting payment method:', error);
        showNotification('Failed to delete payment method: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
  );
}

async function loadChatMessages() { // For Global Chat
  const chatMessagesContainer = document.getElementById('chat-messages');
  chatMessagesContainer.innerHTML = `
    <div class="loading-spinner mx-auto mb-4"></div>
    <p class="text-center text-text-secondary">Loading messages...</p>
  `;
  chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight; // Scroll to bottom

  try {
    // Fetch all conversations (admin can see all)
    const { data: conversations, error: convError } = await state.supabase
      .from('conversations')
      .select('*');
    if (convError) throw convError;

    // Get messages for all conversations
    const conversationIds = conversations.map(c => c.id);
    if (conversationIds.length === 0) {
      chatMessagesContainer.innerHTML = `
        <div class="text-center text-text-secondary py-8">
          <i class="fas fa-comments text-4xl mb-4"></i>
          <p>No global chat messages yet.</p>
        </div>
      `;
      return;
    }

    const { data: messages, error } = await state.supabase
      .from('chat_messages')
      .select(`
        *,
        sender_profile:profiles!sender_id(username, name, profile_picture),
        sender_admin_profile:admin_profiles!sender_id(username, name, profile_picture)
      `)
      .in('conversation_id', conversationIds)
      .order('created_at', { ascending: true });

    if (error) throw error;

    if (messages && messages.length > 0) {
      chatMessagesContainer.innerHTML = messages.map(msg => {
        const isSenderAdmin = msg.sender_id === state.adminProfile.id;
        const senderProfile = isSenderAdmin ? msg.sender_admin_profile : msg.sender_profile;
        const senderName = isSenderAdmin ? 'Admin (You)' : senderProfile?.name || 'Unknown User';
        const senderUsername = isSenderAdmin ? state.adminProfile.username : senderProfile?.username || 'unknown';
        const senderAvatar = senderProfile?.profile_picture || '/placeholder.svg?height=30&width=30';
        const messageTime = new Date(msg.created_at).toLocaleTimeString('my-MM', { hour: '2-digit', minute: '2-digit' });
        
        return `
          <div class="flex ${isSenderAdmin ? 'justify-end' : 'justify-start'} mb-4">
            <div class="flex ${isSenderAdmin ? 'flex-row-reverse' : 'flex-row'} items-start space-x-2 ${isSenderAdmin ? 'space-x-reverse' : ''}">
              <img src="${senderAvatar}" alt="${senderName}" class="w-8 h-8 rounded-full object-cover">
              <div class="p-3 rounded-lg ${isSenderAdmin ? 'bg-accent-purple text-black' : 'bg-secondary-bg text-text-primary'} max-w-xs md:max-w-md">
                <p class="font-semibold text-sm ${isSenderAdmin ? 'text-black' : 'text-accent-green'}">${senderName} (@${senderUsername})</p>
                <p class="text-text-primary whitespace-pre-wrap">${msg.content}</p>
                <p class="text-xs text-right ${isSenderAdmin ? 'text-gray-800' : 'text-text-secondary'} mt-1">${messageTime}</p>
              </div>
            </div>
          </div>
        `;
      }).join('');
      chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight; // Scroll to bottom after rendering
    } else {
      chatMessagesContainer.innerHTML = `
        <div class="text-center text-text-secondary py-8">
          <i class="fas fa-comments text-4xl mb-4"></i>
          <p>No global chat messages yet.</p>
        </div>
      `;
    }
  } catch (error) {
    console.error('Error loading chat messages:', error);
    chatMessagesContainer.innerHTML = `
      <div class="text-center text-accent-red py-8">
        <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
        <p>Failed to retrieve messages</p>
      </div>
    `;
  }
}

async function sendChatMessage() { // For Global Chat
  if (!state.adminProfile || !state.adminProfile.id) {
    showNotification('Admin profile not loaded. Please re-login.', 'error');
    return;
  }

  const chatInput = document.getElementById('chat-input');
  const messageContent = chatInput.value.trim();

  if (!messageContent) {
    showNotification('Message cannot be empty.', 'warning');
    return;
  }

  chatInput.value = ''; // Clear input immediately

  try {
    // Get or create conversation with a dummy user ID for global chat (or a specific user if replying)
    // For simplicity, we'll assume admin sends to a "global" conversation with a dummy user ID.
    // In a real system, admin would select a user to chat with.
    const dummyUserIdForGlobalChat = 'a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11'; // This is the admin's own ID, effectively making it a self-chat for global announcements
    const { data: conversationId, error: convError } = await state.supabase.rpc('get_or_create_conversation', {
      user1_id: state.adminProfile.id,
      user2_id: dummyUserIdForGlobalChat
    });
    if (convError) throw convError;

    const { error } = await state.supabase
      .from('chat_messages')
      .insert({
        conversation_id: conversationId,
        sender_id: state.adminProfile.id,
        content: messageContent
      });

    if (error) throw error;

    // Message will be reloaded by realtime subscription
  } catch (error) {
    console.error('Error sending chat message:', error);
    showNotification('Failed to send message: ' + error.message, 'error');
  }
}

async function loadSupportMessages() {
  const supportTableBody = document.getElementById('support-table-body');
  supportTableBody.innerHTML = `
    <tr>
      <td colspan="5" class="text-center text-text-secondary py-8">
        <div class="loading-spinner mx-auto mb-2"></div>
        Loading support messages...
      </td>
    </tr>
  `;

  try {
    const { data: messages, error } = await state.supabase
      .from('support_messages')
      .select(`
        *,
        profile:profiles!profile_id(username, name, profile_picture),
        admin_profile:admin_profiles!admin_profile_id(username, name, profile_picture)
      `)
      .order('created_at', { ascending: false });

    if (error) throw error;

    state.allSupportMessages = messages || []; // Cache for filtering
    renderSupportMessages(state.allSupportMessages);

  } catch (error) {
    console.error('Error loading support messages:', error);
    supportTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-accent-red py-8">
          <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
          <p>Failed to retrieve support messages</p>
        </td>
      </tr>
    `;
  }
}

function renderSupportMessages(messagesToRender) {
  const supportTableBody = document.getElementById('support-table-body');
  if (messagesToRender && messagesToRender.length > 0) {
    supportTableBody.innerHTML = messagesToRender.map(msg => {
      const senderName = msg.is_from_user ? (msg.profile?.name || 'Unknown User') : (msg.admin_profile?.name || 'Admin');
      const senderUsername = msg.is_from_user ? (msg.profile?.username || 'unknown') : (msg.admin_profile?.username || 'admin');
      const statusClass = {
        'open': 'text-yellow-400',
        'closed': 'text-accent-green',
        'pending': 'text-blue-400'
      }[msg.status] || 'text-text-secondary';
      
      return `
        <tr>
          <td>${senderName} (@${senderUsername})</td>
          <td>${msg.content.substring(0, 50)}${msg.content.length > 50 ? '...' : ''}</td>
          <td>${msg.priority.toUpperCase()}</td>
          <td class="${statusClass}">${msg.status.toUpperCase()}</td>
          <td class="table-actions">
            <button onclick="viewSupportMessage('${msg.id}')" class="myanmar-btn btn-small">
              <i class="fas fa-eye"></i>
            </button>
            <button onclick="updateSupportMessageStatus('${msg.id}', 'closed')" class="myanmar-btn btn-small">
              <i class="fas fa-check"></i> Close
            </button>
            <button onclick="deleteSupportMessage('${msg.id}')" class="btn-danger myanmar-btn btn-small">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    supportTableBody.innerHTML = `
      <tr>
        <td colspan="5" class="text-center text-text-secondary py-8">
          <i class="fas fa-headset text-4xl mb-4"></i>
          <p>No Support Messages Found</p>
        </td>
      </tr>
    `;
  }
}

async function viewSupportMessage(messageId) {
  showLoading(true);
  try {
    const { data: message, error } = await state.supabase
      .from('support_messages')
      .select(`
        *,
        profile:profiles!profile_id(username, name, profile_picture),
        admin_profile:admin_profiles!admin_profile_id(username, name, profile_picture)
      `)
      .eq('id', messageId)
      .single();

    if (error) throw error;

    const senderName = message.is_from_user ? (message.profile?.name || 'Unknown User') : (message.admin_profile?.name || 'Admin');
    const senderUsername = message.is_from_user ? (message.profile?.username || 'unknown') : (message.admin_profile?.username || 'admin');
    const senderAvatar = message.is_from_user ? (message.profile?.profile_picture || '/placeholder.svg?height=40&width=40') : (message.admin_profile?.profile_picture || '/placeholder.svg?height=40&width=40');

    document.getElementById('news-modal-content').innerHTML = `
      <div class="space-y-4">
        <div class="flex items-center space-x-3">
          <img src="${senderAvatar}" 
               alt="Sender" class="w-10 h-10 rounded-full object-cover">
          <div>
            <h4 class="font-semibold text-text-primary">${senderName} (@${senderUsername})</h4>
            <p class="text-sm text-text-secondary">
              <i class="fas fa-calendar mr-1"></i> ${new Date(message.created_at).toLocaleString('my-MM')}
            </p>
          </div>
        </div>
        
        <h3 class="text-xl font-bold text-accent-purple">Support Message</h3>
        
        <p class="text-text-secondary whitespace-pre-wrap">${message.content}</p>
        
        <div class="flex items-center justify-between text-sm text-text-secondary pt-4 border-t border-border-color">
          <span>Priority: ${message.priority.toUpperCase()}</span>
          <span>Status: ${message.status.toUpperCase()}</span>
        </div>
        <div class="mt-4">
          <textarea id="reply-support-input" placeholder="Reply to this message..." rows="3" class="app-input w-full resize-none mb-2"></textarea>
          <button onclick="replyToSupportMessage('${message.id}', '${message.profile_id}')" class="myanmar-btn w-full">
            <i class="fas fa-reply mr-2"></i> SEND REPLY
          </button>
        </div>
      </div>
    `;

    document.getElementById('news-modal').classList.remove('hidden'); // Reusing news modal for support message detail

  } catch (error) {
    console.error('Error viewing support message:', error);
    showNotification('Failed to view Support Message', 'error');
  } finally {
    showLoading(false);
  }
}

async function replyToSupportMessage(originalMessageId, userId) {
  const replyContent = document.getElementById('reply-support-input').value.trim();
  if (!replyContent) {
    showNotification('Reply cannot be empty.', 'warning');
    return;
  }

  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('support_messages')
      .insert({
        profile_id: userId, // The user who sent the original message
        admin_profile_id: state.adminProfile.id, // Admin sending the reply
        content: replyContent,
        is_from_user: false, // This is an admin reply
        priority: 'normal', // Can be set dynamically based on original message
        status: 'pending' // Mark as pending until user responds or admin closes
      });

    if (error) throw error;

    showNotification('Reply sent successfully!', 'success');
    document.getElementById('reply-support-input').value = '';
    loadSupportMessages(); // Refresh list
    closeNewsModal(); // Close the detail modal
  } catch (error) {
    console.error('Error sending reply:', error);
    showNotification('Failed to send reply: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

async function updateSupportMessageStatus(messageId, newStatus) {
  showLoading(true);
  try {
    const { error } = await state.supabase
      .from('support_messages')
      .update({ status: newStatus })
      .eq('id', messageId);

    if (error) throw error;

    showNotification(`Support message status updated to ${newStatus.toUpperCase()}`, 'success');
    loadSupportMessages();
  } catch (error) {
    console.error('Error updating support message status:', error);
    showNotification('Failed to update support message status: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

function deleteSupportMessage(messageId) {
  showConfirmModal(
    'Are you sure you want to delete this support message?',
    async () => {
      showLoading(true);
      try {
        const { error } = await state.supabase
          .from('support_messages')
          .delete()
          .eq('id', messageId);

        if (error) throw error;

        showNotification('Support message deleted successfully!', 'success');
        loadSupportMessages();
      } catch (error) {
        console.error('Error deleting support message:', error);
        showNotification('Failed to delete support message: ' + error.message, 'error');
      } finally {
        showLoading(false);
      }
    }
  );
}

async function loadAboutData() {
  const aboutContent = document.getElementById('about-section').querySelector('.app-card');
  aboutContent.innerHTML = `
    <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
      <i class="fas fa-info-circle mr-3"></i>
      MANAGE ABOUT US
    </h3>
    <div class="loading-spinner mx-auto mb-4"></div>
    <p class="text-center text-text-secondary">Loading about information...</p>
  `;

  try {
    const { data, error } = await state.supabase
      .from('about')
      .select('*')
      .eq('id', 'main')
      .single();

    if (error) throw error;

    if (data) {
      document.getElementById('about-contact-name').value = data.contact_name || '';
      document.getElementById('about-phone').value = data.phone || '';
      document.getElementById('about-email').value = data.email || '';
      document.getElementById('about-telegram').value = data.telegram || '';
      document.getElementById('about-viber').value = data.viber || '';
      document.getElementById('about-facebook').value = data.facebook || '';
      document.getElementById('about-tiktok').value = data.tiktok || '';
      document.getElementById('about-social-links').value = data.social_links ? JSON.stringify(data.social_links, null, 2) : '[]';
    } else {
      // If no data, initialize with empty values
      document.getElementById('about-contact-name').value = '';
      document.getElementById('about-phone').value = '';
      document.getElementById('about-email').value = '';
      document.getElementById('about-telegram').value = '';
      document.getElementById('about-viber').value = '';
      document.getElementById('about-facebook').value = '';
      document.getElementById('about-tiktok').value = '';
      document.getElementById('about-social-links').value = '[]';
    }
  } catch (error) {
    console.error('Error loading about data:', error);
    showNotification('Failed to retrieve About information: ' + error.message, 'error');
  } finally {
    // Restore original form structure after loading
    aboutContent.innerHTML = `
      <h3 class="text-lg md:text-xl font-orbitron font-bold mb-6 text-accent-purple flex items-center">
        <i class="fas fa-info-circle mr-3"></i>
        MANAGE ABOUT US
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">CONTACT NAME</label>
          <input type="text" id="about-contact-name" placeholder="Contact Name" class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">PHONE</label>
          <input type="text" id="about-phone" placeholder="Phone Number" class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">EMAIL</label>
          <input type="email" id="about-email" placeholder="Email Address" class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">TELEGRAM LINK</label>
          <input type="url" id="about-telegram" placeholder="https://t.me/..." class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">VIBER LINK</label>
          <input type="url" id="about-viber" placeholder="viber://chat?number=..." class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">FACEBOOK LINK</label>
          <input type="url" id="about-facebook" placeholder="https://facebook.com/..." class="app-input w-full">
        </div>
        <div>
          <label class="block text-sm font-medium mb-2 text-text-secondary">TIKTOK LINK</label>
          <input type="url" id="about-tiktok" placeholder="https://tiktok.com/@..." class="app-input w-full">
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-medium mb-2 text-text-secondary">SOCIAL LINKS (JSON Array - optional)</label>
          <textarea id="about-social-links" rows="3" placeholder='[{"name": "Website", "url": "...", "icon_url": "..."}]' class="app-input w-full resize-none font-share-tech"></textarea>
          <p class="text-xs text-text-secondary mt-1">
            Example: `[{"name": "Website", "url": "https://www.example.com", "icon_url": "/placeholder.svg?height=24&width=24"}]`
          </p>
        </div>
        <div class="md:col-span-2">
          <button onclick="updateAbout()" class="myanmar-btn w-full flex items-center justify-center space-x-2">
            <i class="fas fa-save"></i>
            <span>UPDATE ABOUT INFO</span>
          </button>
        </div>
      </div>
    `;
    // Re-populate values after restoring HTML structure
    if (data) {
      document.getElementById('about-contact-name').value = data.contact_name || '';
      document.getElementById('about-phone').value = data.phone || '';
      document.getElementById('about-email').value = data.email || '';
      document.getElementById('about-telegram').value = data.telegram || '';
      document.getElementById('about-viber').value = data.viber || '';
      document.getElementById('about-facebook').value = data.facebook || '';
      document.getElementById('about-tiktok').value = data.tiktok || '';
      document.getElementById('about-social-links').value = data.social_links ? JSON.stringify(data.social_links, null, 2) : '[]';
    }
  }
}

async function updateAbout() {
  const contactName = document.getElementById('about-contact-name').value.trim();
  const phone = document.getElementById('about-phone').value.trim();
  const email = document.getElementById('about-email').value.trim();
  const telegram = document.getElementById('about-telegram').value.trim();
  const viber = document.getElementById('about-viber').value.trim();
  const facebook = document.getElementById('about-facebook').value.trim();
  const tiktok = document.getElementById('about-tiktok').value.trim();
  const socialLinksRaw = document.getElementById('about-social-links').value.trim();

  showLoading(true);

  try {
    let socialLinks = [];
    if (socialLinksRaw) {
      try {
        socialLinks = JSON.parse(socialLinksRaw);
        if (!Array.isArray(socialLinks)) throw new Error('Social links must be a JSON array.');
      } catch (e) {
        showNotification('Invalid Social Links JSON format. Please use: [{"name": "...", "url": "...", "icon_url": "..."}]', 'error', 10000);
        return;
      }
    }

    const { error } = await state.supabase
      .from('about')
      .upsert({
        id: 'main', // Always update the single 'main' row
        contact_name: contactName || null,
        phone: phone || null,
        email: email || null,
        telegram: telegram || null,
        viber: viber || null,
        facebook: facebook || null,
        tiktok: tiktok || null,
        social_links: socialLinks.length > 0 ? socialLinks : null
      });

    if (error) throw error;

    showNotification('About information updated successfully!', 'success');
    loadAboutData(); // Refresh data
  } catch (error) {
    console.error('Error updating about info:', error);
    showNotification('Failed to update about information: ' + error.message, 'error');
  } finally {
    showLoading(false);
  }
}

// General UI functions
function showLoading(show) {
  document.getElementById('loading-overlay').classList.toggle('hidden', !show);
}

function showConfirmModal(message, callback) {
  document.getElementById('confirm-message').textContent = message;
  document.getElementById('confirm-modal').classList.remove('hidden');
  state.confirmCallback = callback;
}

function closeConfirmModal() {
  document.getElementById('confirm-modal').classList.add('hidden');
  state.confirmCallback = null;
}

function confirmAction() {
  if (state.confirmCallback) {
    state.confirmCallback();
  }
  closeConfirmModal();
}

function filterTable(tableBodyId, searchTerm) {
  const tableBody = document.getElementById(tableBodyId);
  if (!tableBody) return;

  const rows = tableBody.getElementsByTagName('tr');
  const filter = searchTerm.toLowerCase();

  for (let i = 0; i < rows.length; i++) {
    let rowText = rows[i].textContent || rows[i].innerText;
    if (rowText.toLowerCase().indexOf(filter) > -1) {
      rows[i].style.display = '';
    } else {
      rows[i].style.display = 'none';
    }
  }
}

</script>
</body>
</html>
